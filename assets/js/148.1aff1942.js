(window.webpackJsonp=window.webpackJsonp||[]).push([[148],{386:function(e,t,s){"use strict";s.r(t);var a=s(1),n=Object(a.a)({},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"how-you-can-learn-dependency-injection-in-net-core-and-c"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#how-you-can-learn-dependency-injection-in-net-core-and-c","aria-hidden":"true"}},[e._v("#")]),e._v(" How YOU can Learn Dependency Injection in .NET Core and C#")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://thepracticaldev.s3.amazonaws.com/i/69mlfxzpei2p9ggc0xls.jpg",alt:""}})]),e._v(" "),s("p",[e._v("Follow me on "),s("a",{attrs:{href:"https://twitter.com/chris_noring",target:"_blank",rel:"noopener noreferrer"}},[e._v("Twitter"),s("OutboundLink")],1),e._v(", happy to take your suggestions on topics or improvements /Chris")]),e._v(" "),s("p",[e._v("This is an intro to Dependency Injection, also called DI. I plan a follow-up post covering more advanced scenarios. For now, I want to explain what it is and how you can use it and finally show how it helps to test A LOT.")]),e._v(" "),s("h2",{attrs:{id:"what-is-dependency-injection"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#what-is-dependency-injection","aria-hidden":"true"}},[e._v("#")]),e._v(" What is Dependency Injection")]),e._v(" "),s("p",[e._v("It's a programming technique that makes a class independent of its dependencies.")]),e._v(" "),s("blockquote",[s("p",[e._v("English?")])]),e._v(" "),s("p",[e._v("We don't rely on a concrete implementation of our dependencies, but rather interfaces. This makes our code more flexible and we can easily switch out a concrete implementation for another while maintaining the same logic.")]),e._v(" "),s("h2",{attrs:{id:"references"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#references","aria-hidden":"true"}},[e._v("#")]),e._v(" References")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://docs.microsoft.com/aspnet/core/fundamentals/dependency-injection?view=aspnetcore-3.0&wt.mc_id=academic-0000-chnoring",target:"_blank",rel:"noopener noreferrer"}},[e._v("Overview of Dependency Injection"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://docs.microsoft.com/aspnet/core/mvc/views/dependency-injection?view=aspnetcore-3.0&wt.mc_id=academic-0000-chnoring",target:"_blank",rel:"noopener noreferrer"}},[e._v("DI MVC example"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://docs.microsoft.com/aspnet/core/mvc/controllers/dependency-injection?view=aspnetcore-3.0&wt.mc_id=academic-0000-chnoring",target:"_blank",rel:"noopener noreferrer"}},[e._v("DI in Controllers"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://www.martinfowler.com/articles/injection.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Dependency Injection pattern by Martin Fowler"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://docs.microsoft.com/en-us/dotnet/api/microsoft.extensions.dependencyinjectionview=dotnet-plat-ext-3.0&wt.mc_id=academic-0000-chnoring",target:"_blank",rel:"noopener noreferrer"}},[e._v("Overview of Dependency Injection namespace"),s("OutboundLink")],1)])]),e._v(" "),s("h2",{attrs:{id:"why-use-it"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#why-use-it","aria-hidden":"true"}},[e._v("#")]),e._v(" Why use it")]),e._v(" "),s("p",[e._v("There are many advantages:")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("Flexible code")]),e._v(", we can switch out one implementation for another without changing the business logic.")]),e._v(" "),s("li",[s("strong",[e._v("Easy to test")]),e._v(", because we rely on interfaces over implementations - we can more easily test our code without worrying about side-effects. We will show this later in the article.")])]),e._v(" "),s("h2",{attrs:{id:"di-in-net-core-it-s-built-in"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#di-in-net-core-it-s-built-in","aria-hidden":"true"}},[e._v("#")]),e._v(" DI in .NET Core - it's built-in")]),e._v(" "),s("p",[e._v("There's a built-in Dependency Injection container that's used by a lot of internal services like:")]),e._v(" "),s("ul",[s("li",[e._v("Hosting Environment")]),e._v(" "),s("li",[e._v("Configuration")]),e._v(" "),s("li",[e._v("Routing")]),e._v(" "),s("li",[e._v("MVC")]),e._v(" "),s("li",[e._v("ApplicationLifetime")]),e._v(" "),s("li",[e._v("Logging")])]),e._v(" "),s("p",[e._v("The container is sometimes referred to as IoC, "),s("strong",[e._v("I")]),e._v("nversion of "),s("strong",[e._v("C")]),e._v("ontrol "),s("strong",[e._v("C")]),e._v("ontainer.")]),e._v(" "),s("p",[e._v("The overall idea is to "),s("em",[e._v("Register")]),e._v(" at the application startup and then "),s("em",[e._v("Resolve")]),e._v(" at runtime when needed.")]),e._v(" "),s("p",[e._v("Container responsibilities:")]),e._v(" "),s("ul",[s("li",[e._v("Creating")]),e._v(" "),s("li",[e._v("Disposing")])]),e._v(" "),s("p",[e._v("Key concepts:")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("IServiceCollection")]),e._v(", Register services, lets the IoC container know of concrete implementation. It should be used to resolve what Interface belongs to what implementation. How something is created can be as simple as just instantiating an object but sometimes we need more data than that.")]),e._v(" "),s("li",[s("strong",[e._v("IServiceProvider")]),e._v(", Resolve service instances, actually looking up what interface belongs to what concrete implementation and carry out the creation.")])]),e._v(" "),s("p",[e._v("It lives in the "),s("code",[e._v("Microsoft.Extensions.DependencyInjection")]),e._v(" namespace. All the classes and code related to DI can be found there.")]),e._v(" "),s("h3",{attrs:{id:"what-to-register"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#what-to-register","aria-hidden":"true"}},[e._v("#")]),e._v(" What to register")]),e._v(" "),s("p",[e._v("There are some telltale signs.")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("Lifespan outside of this method?")]),e._v(", Are we "),s("em",[e._v("new-ing")]),e._v(" the service, any services our can they live within the scope of the method? I.e are they a dependency or not?")]),e._v(" "),s("li",[s("strong",[e._v("More than one version")]),e._v(", Can there be more than one version of this service?")]),e._v(" "),s("li",[s("strong",[e._v("Testability")]),e._v(", ideally you only want to test a specific method. If you got code that does a lot of other things in your method, you probably want to move that to a dedicated service. This moved code would then become dependencies to the method in question")]),e._v(" "),s("li",[s("strong",[e._v("Side-effect")]),e._v(", This is similar to the point above but it stresses the importance of having a method that does only one thing. If a side-effect is produced, i.e accessing a network resource, doing an HTTP call or interacting with I/O - then it should be placed in a separate service and be injected in as a dependency.")])]),e._v(" "),s("p",[e._v("Essentially, you will end up moving out code to dedicated services and then inject these services as dependencies via a constructor. You might start out with code looking like so:")]),e._v(" "),s("div",{staticClass:"language-csharp line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("Action")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("double")]),e._v(" amount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("string")]),e._v(" cardNumber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("string")]),e._v(" address"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("string")]),e._v(" city"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("string")]),e._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" paymentService "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("PaymentService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" successfullyCharged "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" paymentService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("Charge")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("int")]),e._v(" amount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" cardNumber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("successfullyCharged"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" \n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" shippingService "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ShippingService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    shippingService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("Ship")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("address"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" city"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br")])]),s("p",[e._v("The above has many problems:")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("Unwanted side-effects when testing")]),e._v(", The first problem is that we control the lifetime of "),s("code",[e._v("PaymentService")]),e._v(" and "),s("code",[e._v("ShippingService")]),e._v(", thus risking firing off a side-effect, an HTTP call, when trying to test.")]),e._v(" "),s("li",[s("strong",[e._v("Can't test all paths")]),e._v(", we can't really test all paths, we can't ask the PaymentService to respond differently so we can test all execution paths")]),e._v(" "),s("li",[s("strong",[e._v("Hard to extend")]),e._v(", will this PaymentService cover all the possible means of payment or would we need to add a lot of conditional code in this method to cover different ways of taking payment if we added say support for "),s("em",[e._v("PayPal")]),e._v(" or a new type of card, etc?")]),e._v(" "),s("li",[s("strong",[e._v("Unvalidated Primitives")]),e._v(", there are primitives like "),s("code",[e._v("double")]),e._v(" and "),s("code",[e._v("string")]),e._v(". Can we trust those values, is the "),s("code",[e._v("address")]),e._v(" a valid address for example?")])]),e._v(" "),s("p",[e._v("From the above, we realize that we need to refactor our code into something more maintainable and more secure. Turning a lot of the code into dependencies and replacing primitives with more complex constructs, is a good way to go.")]),e._v(" "),s("p",[e._v("The result could look something like this:")]),e._v(" "),s("div",{staticClass:"language-csharp line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("class")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Controller")]),e._v(" \n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("private")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("readonly")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("IPaymentService")]),e._v(" _paymentService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("private")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("readonly")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("IShippingService")]),e._v(" _shippingService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("Controller")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("IPaymentService")]),e._v(" paymentService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("IShippingService")]),e._v(" shippingService\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" \n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    _paymentService "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" paymentService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    _shippingService "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" shippingService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("Action")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("IPaymentInfo")]),e._v(" paymentInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("IShippingAddress")]),e._v(" shippingAddress"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" \n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" successfullyCharged "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" _paymentService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("Charge")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("paymentInfo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("successfullyCharged"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      _shippingService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("Ship")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("ShippingAddress"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br")])]),s("p",[e._v("Above we have turned both the "),s("code",[e._v("PaymentService")]),e._v(" and "),s("code",[e._v("ShippingService")]),e._v(" into dependencies that we inject in the constructor. We also see that all the primitives have been collected into the complex structures "),s("code",[e._v("IShippingAddress")]),e._v(" and "),s("code",[e._v("IPaymentInfo")]),e._v(".")]),e._v(" "),s("h3",{attrs:{id:"dependency-graph"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dependency-graph","aria-hidden":"true"}},[e._v("#")]),e._v(" Dependency Graph")]),e._v(" "),s("p",[e._v("When you have a dependency it might itself rely on another dependency being resolved first and so on and so forth. This means we get a hierarchy of dependencies that need to be resolved in the right order for things to work out. We call this a "),s("em",[e._v("Dependency Graph")]),e._v(".")]),e._v(" "),s("h2",{attrs:{id:"demo-registering-a-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#demo-registering-a-service","aria-hidden":"true"}},[e._v("#")]),e._v(" DEMO - registering a Service")]),e._v(" "),s("p",[e._v("We will do the following:")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("create")]),e._v(" a .NET Core solution")]),e._v(" "),s("li",[s("strong",[e._v("add")]),e._v(" a webapi project to our solution")]),e._v(" "),s("li",[s("strong",[e._v("fail")]),e._v(", see what happens if we forgot to register a service. It's important to recognize the error message so we know where we went wrong and can fix it")]),e._v(" "),s("li",[s("strong",[e._v("registering a service")]),e._v(", we will register our service and we will now see how everything works")])]),e._v(" "),s("h3",{attrs:{id:"create-a-solution"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#create-a-solution","aria-hidden":"true"}},[e._v("#")]),e._v(" Create a solution")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("mkdir di-demo\ncd di-demo\n\ndotnet new sln\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br")])]),s("p",[e._v("this will create the following structure:")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("-| di-demo\n---| di-demo.sln\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("h3",{attrs:{id:"create-a-webapi-project"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#create-a-webapi-project","aria-hidden":"true"}},[e._v("#")]),e._v(" Create a WebApi project")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("dotnet new webapi -o api\ndotnet sln add api/api.csproj\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("p",[e._v("The above will create a "),s("code",[e._v("webapi")]),e._v(" project and add it to our solution file.")]),e._v(" "),s("p",[e._v("Now we have the following structure:")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("-| di-demo\n---| di-demo.sln\n---| api/\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br")])]),s("h3",{attrs:{id:"fail"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fail","aria-hidden":"true"}},[e._v("#")]),e._v(" fail")]),e._v(" "),s("p",[e._v("First, we will compile and run our project so we type:")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("dotnet run\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("First time you run the project the web browser might tell you something like "),s("em",[e._v("your connection is not secure")]),e._v(". You have a dev cert that's not trusted. Fortunately, there's a built-in tool that can fix this so you can run a command like this:")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("dotnet dev-certs https --trust\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("For more context on the problem:")]),e._v(" "),s("blockquote",[s("p",[e._v("https://www.hanselman.com/blog/DevelopingLocallyWithASPNETCoreUnderHTTPSSSLAndSelfSignedCerts.aspx")])]),e._v(" "),s("p",[e._v("You should have something like this running:")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://thepracticaldev.s3.amazonaws.com/i/tqejf0xhgfhuf35vo1eh.png",alt:""}})]),e._v(" "),s("p",[e._v("Ok then, we don't have an error but let's introduce one.")]),e._v(" "),s("p",[e._v("Let's do the following:")]),e._v(" "),s("ol",[s("li",[s("strong",[e._v("Create a controller")]),e._v(" that supports getting products, this should inject a "),s("code",[e._v("ProductsService")])]),e._v(" "),s("li",[s("strong",[e._v("Create a ProductsService")]),e._v(", this should be able to retrieve Products from a data source")]),e._v(" "),s("li",[e._v("**Create a IProductsService interface, inject this interface in the controller")])]),e._v(" "),s("p",[s("strong",[e._v("Add a ProductsController")])]),e._v(" "),s("p",[e._v("Add the file "),s("code",[e._v("ProductsController.cs")]),e._v(" with the following content:")]),e._v(" "),s("div",{staticClass:"language-csharp line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("using")]),e._v(" System"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("using")]),e._v(" System"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("Collections"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("Generic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("using")]),e._v(" System"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("Linq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("using")]),e._v(" System"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("Threading"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("Tasks"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("using")]),e._v(" Microsoft"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("AspNetCore"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("Mvc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("using")]),e._v(" Services"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("namespace")]),e._v(" api"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("Controllers\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ApiController")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"[controller]"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("class")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ProductsController")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ControllerBase")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("private")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("readonly")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("IProductsService")]),e._v(" _productsService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("ProductsController")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("IProductsService")]),e._v(" productsService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      _productsService "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" productsService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("HttpGet")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" IEnumerable"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("Product"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("GetProducts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" _productsService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("GetProducts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br"),s("span",{staticClass:"line-number"},[e._v("24")]),s("br"),s("span",{staticClass:"line-number"},[e._v("25")]),s("br")])]),s("p",[e._v("Note how we "),s("em",[e._v("inject")]),e._v(" the "),s("code",[e._v("IProductsService")]),e._v(" in the constructor. This file should be added to the "),s("code",[e._v("Controllers")]),e._v(" directory.")]),e._v(" "),s("p",[s("strong",[e._v("Add a ProductsService")])]),e._v(" "),s("p",[e._v("Let's create a file "),s("code",[e._v("ProductsService.cs")]),e._v(" under a directory "),s("code",[e._v("Services")]),e._v(", with the following content:")]),e._v(" "),s("div",{staticClass:"language-csharp line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("using")]),e._v(" System"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("using")]),e._v(" System"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("Collections"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("Generic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("using")]),e._v(" System"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("Linq"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("namespace")]),e._v(" Services "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("class")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Product")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("string")]),e._v(" Title "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("set")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("class")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ProductsService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("IProductsService")]),e._v(" \n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("private")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("readonly")]),e._v(" List"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("Product"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" Products "),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("List")]),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("Product"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" \n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Product")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" Title"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"DVD player"')]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Product")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" Title"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"TV"')]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Product")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" Title"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Projector"')]),e._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" IEnumerable"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("Product"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("GetProducts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" \n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" Products"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("AsEnumerable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br"),s("span",{staticClass:"line-number"},[e._v("24")]),s("br")])]),s("p",[s("strong",[e._v("Create an interface IProductsController")])]),e._v(" "),s("p",[e._v("Let's create the file "),s("code",[e._v("IProductsController.cs")]),e._v(" under the "),s("code",[e._v("Services")]),e._v(" directory, with the following content:")]),e._v(" "),s("div",{staticClass:"language-csharp line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("using")]),e._v(" System"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("using")]),e._v(" System"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("Collections"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("Generic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("namespace")]),e._v(" Services \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("interface")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("IProductsService")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      IEnumerable"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("Product"),s("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("GetProducts")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br")])]),s("p",[s("strong",[e._v("Run")])]),e._v(" "),s("p",[e._v("Let's run the project with:")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("dotnet build\ndotnet run\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("p",[e._v("We should get the following response in the browser:")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://thepracticaldev.s3.amazonaws.com/i/p5163j4fxgq8qq6o6by6.png",alt:""}})]),e._v(" "),s("p",[e._v("It's failing, just like we planned. Now what?")]),e._v(" "),s("p",[e._v("Well, we fix it, by registering it with our container.")]),e._v(" "),s("h3",{attrs:{id:"registering-a-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#registering-a-service","aria-hidden":"true"}},[e._v("#")]),e._v(" Registering a service")]),e._v(" "),s("p",[e._v("Ok, let's fix our problem. We do so by opening up the file "),s("code",[e._v("Startup.cs")]),e._v(" in the project root. Let's find the "),s("code",[e._v("ConfigureServices()")]),e._v(" method. It should have the following implementation currently:")]),e._v(" "),s("div",{staticClass:"language-csharp line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("ConfigureServices")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("IServiceCollection")]),e._v(" services"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    services"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("AddControllers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br")])]),s("p",[e._v("Let's change the code to the following:")]),e._v(" "),s("div",{staticClass:"language-csharp line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-csharp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("public")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("void")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("ConfigureServices")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("IServiceCollection")]),e._v(" services"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    services"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token generic-method"}},[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("AddTransient")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("IProductsService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("ProductsService")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    services"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("AddControllers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br")])]),s("p",[e._v("The call to "),s("code",[e._v("services.AddTransient()")]),e._v(" registers "),s("code",[e._v("IProductsService")]),e._v(" and associates it with the implementing class "),s("code",[e._v("ProductsService")]),e._v(". If we run our code again:")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("dotnet run\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br")])]),s("p",[e._v("Now your browser should be happy and look like this:")]),e._v(" "),s("p",[s("img",{attrs:{src:"https://thepracticaldev.s3.amazonaws.com/i/tobp1d7nis6v2yfwdbkz.png",alt:""}})]),e._v(" "),s("blockquote",[s("p",[e._v("Do we know all we need to know now?")])]),e._v(" "),s("p",[e._v("No, there's lots more to know. So please read on in the next section to find out about different lifetimes, "),s("em",[e._v("transient")]),e._v(" is but one type of lifetime type.")]),e._v(" "),s("h2",{attrs:{id:"service-lifetimes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#service-lifetimes","aria-hidden":"true"}},[e._v("#")]),e._v(" Service lifetimes")]),e._v(" "),s("p",[e._v("The service life time means how long the service will live, before it's being garbage collected. There are currently three different lifetimes:")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("Transient")]),e._v(", "),s("code",[e._v("services.AddTransient()")]),e._v(", the service is created each time it is requested")]),e._v(" "),s("li",[s("strong",[e._v("Singleton")]),e._v(", "),s("code",[e._v("services.AddSingleton()")]),e._v(", created once for the lifetime of the application")]),e._v(" "),s("li",[s("strong",[e._v("Scoped")]),e._v(", "),s("code",[e._v("services.AddScoped()")]),e._v(", created once per request")])]),e._v(" "),s("blockquote",[s("p",[e._v("So when to use each kind?")])]),e._v(" "),s("p",[e._v("Good question.")]),e._v(" "),s("h3",{attrs:{id:"transient"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#transient","aria-hidden":"true"}},[e._v("#")]),e._v(" Transient")]),e._v(" "),s("p",[e._v("So for Transient, it makes sense to use when you have a mutable state and it's important that the service consumer gets their own copy of this service. Also when thread-safety is not a requirement. This is a good "),s("em",[e._v("default")]),e._v(" choice when you don't know what life time to go with.")]),e._v(" "),s("h3",{attrs:{id:"singleton"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#singleton","aria-hidden":"true"}},[e._v("#")]),e._v(" Singleton")]),e._v(" "),s("p",[e._v("Singleton means that we have one instance for the lifetime of the application. This is good if we want to share state or creating the Service is considered expensive and we want to create it only once. So this can boost performance as it's only created once and garbage collected once. Because it can be accessed by many consumers thread-safety is a thing that needs to be considered. A good use case here is a memory cache but ensure you are making it thread-safe. Read more here about how to make something "),s("em",[e._v("thread-safe")]),e._v(":")]),e._v(" "),s("blockquote",[s("p",[e._v("http://www.albahari.com/threading/part2.aspx")])]),e._v(" "),s("p",[e._v("Read especially about the "),s("code",[e._v("lock")]),e._v(" keyword in the above link.")]),e._v(" "),s("h3",{attrs:{id:"scoped"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#scoped","aria-hidden":"true"}},[e._v("#")]),e._v(" Scoped")]),e._v(" "),s("p",[e._v("Scoped means it's created once per request. So all calling consumers within that request will get the same instance. Examples of scoped services are for example "),s("code",[e._v("DbContext")]),e._v(" for Entity Framework. It's the class we use to access a Database. It makes sense to make it "),s("em",[e._v("scoped")]),e._v(". We are likely to do more than one call to it during our request and the resource should be scoped to that specific request/user.")]),e._v(" "),s("h3",{attrs:{id:"here-be-dragons"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#here-be-dragons","aria-hidden":"true"}},[e._v("#")]),e._v(" Here be dragons")]),e._v(" "),s("p",[e._v("There's such a thing as "),s("em",[e._v("captured dependencies")]),e._v(". This means that a service lives longer than expected.")]),e._v(" "),s("blockquote",[s("p",[e._v("So why is that bad?")])]),e._v(" "),s("p",[e._v("Well, you want services to live according to their lifetime, otherwise, we take up unnecessary space in memory.")]),e._v(" "),s("blockquote",[s("p",[e._v("How does it happen?")])]),e._v(" "),s("p",[e._v("When you start depending on a Service with a shorter lifetime than yourself you are effectively "),s("em",[e._v("capturing")]),e._v(" it, forcing it to stay around according to your lifetime. Example:")]),e._v(" "),s("p",[e._v("You register a "),s("code",[e._v("ProductsService")]),e._v(" with a scoped lifetime and an "),s("code",[e._v("ILogService")]),e._v(" with a transient lifetime. Then you inject the "),s("code",[e._v("ILogService")]),e._v(" into the "),s("code",[e._v("ProductsService")]),e._v(" constructor and thereby "),s("em",[e._v("capturing")]),e._v(" it.")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("class ProductsService \n{\n  ProductsService(ILogService logService) \n  {\n\n  }\n}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br")])]),s("blockquote",[s("p",[e._v("Don't do that!")])]),e._v(" "),s("p",[e._v("If you are going to depend on something ensure that what you inject has an equal or longer life time than yourself. So either change what you depend on or change the lifetime of your dependency.")]),e._v(" "),s("h2",{attrs:{id:"summary"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#summary","aria-hidden":"true"}},[e._v("#")]),e._v(" Summary")]),e._v(" "),s("p",[e._v("We have explained what Dependency Injection is and why it's a good idea to use it. Additionally, we have shown how the built-in container helps us register our dependencies. Lastly, we've discussed how there are different lifetimes for a dependency and which one we should be choosing.")]),e._v(" "),s("p",[e._v("This was the first part of the built-in container. I hope you are excited about a follow-up post talking about some of its more advanced features.")])])},[],!1,null,null,null);t.default=n.exports}}]);