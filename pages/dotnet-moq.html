<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>How YOU can Learn Mock testing in .NET Core and C# with Moq</title>
    <meta name="description" content="This will teach you how to do Mock testing in .NET Core and C# with the library Moq">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    
    <link rel="preload" href="/assets/css/0.styles.1f33e7c2.css" as="style"><link rel="preload" href="/assets/js/app.95c997f3.js" as="script"><link rel="preload" href="/assets/js/9.454b5262.js" as="script"><link rel="preload" href="/assets/js/4.eac68367.js" as="script"><link rel="preload" href="/assets/js/154.11f5eee4.js" as="script"><link rel="prefetch" href="/assets/js/1.36663999.js"><link rel="prefetch" href="/assets/js/10.6aaebcfe.js"><link rel="prefetch" href="/assets/js/100.f7776fae.js"><link rel="prefetch" href="/assets/js/101.83c4ff25.js"><link rel="prefetch" href="/assets/js/102.d3a51c53.js"><link rel="prefetch" href="/assets/js/103.005176e9.js"><link rel="prefetch" href="/assets/js/104.ad6ac0a2.js"><link rel="prefetch" href="/assets/js/105.1c2918c1.js"><link rel="prefetch" href="/assets/js/106.84577e76.js"><link rel="prefetch" href="/assets/js/107.39206cda.js"><link rel="prefetch" href="/assets/js/108.b717e412.js"><link rel="prefetch" href="/assets/js/109.a0275c41.js"><link rel="prefetch" href="/assets/js/11.e44a9c79.js"><link rel="prefetch" href="/assets/js/110.acd428a7.js"><link rel="prefetch" href="/assets/js/111.85c1f355.js"><link rel="prefetch" href="/assets/js/112.62bab5e5.js"><link rel="prefetch" href="/assets/js/113.30083b82.js"><link rel="prefetch" href="/assets/js/114.2dcc568f.js"><link rel="prefetch" href="/assets/js/115.2ee55351.js"><link rel="prefetch" href="/assets/js/116.44cdb765.js"><link rel="prefetch" href="/assets/js/117.f22ffed2.js"><link rel="prefetch" href="/assets/js/118.fda8edf7.js"><link rel="prefetch" href="/assets/js/119.1ea9eae7.js"><link rel="prefetch" href="/assets/js/12.02e6e552.js"><link rel="prefetch" href="/assets/js/120.cf073939.js"><link rel="prefetch" href="/assets/js/121.d06bb8bc.js"><link rel="prefetch" href="/assets/js/122.533a0953.js"><link rel="prefetch" href="/assets/js/123.382bf140.js"><link rel="prefetch" href="/assets/js/124.1e416617.js"><link rel="prefetch" href="/assets/js/125.88e1d9ef.js"><link rel="prefetch" href="/assets/js/126.ac7f0ed9.js"><link rel="prefetch" href="/assets/js/127.2452b31c.js"><link rel="prefetch" href="/assets/js/128.4387dd5e.js"><link rel="prefetch" href="/assets/js/129.57ea763a.js"><link rel="prefetch" href="/assets/js/13.215ad842.js"><link rel="prefetch" href="/assets/js/130.db7a97a9.js"><link rel="prefetch" href="/assets/js/131.cb028185.js"><link rel="prefetch" href="/assets/js/132.1f53aba9.js"><link rel="prefetch" href="/assets/js/133.3e4f88da.js"><link rel="prefetch" href="/assets/js/134.78b60412.js"><link rel="prefetch" href="/assets/js/135.67d56f81.js"><link rel="prefetch" href="/assets/js/136.5f5c962b.js"><link rel="prefetch" href="/assets/js/137.a4bdc628.js"><link rel="prefetch" href="/assets/js/138.9e4dca1e.js"><link rel="prefetch" href="/assets/js/139.ff87d106.js"><link rel="prefetch" href="/assets/js/14.12340cee.js"><link rel="prefetch" href="/assets/js/140.345c5f56.js"><link rel="prefetch" href="/assets/js/141.7ca86301.js"><link rel="prefetch" href="/assets/js/142.dd05b794.js"><link rel="prefetch" href="/assets/js/143.c0950d2f.js"><link rel="prefetch" href="/assets/js/144.e36983d5.js"><link rel="prefetch" href="/assets/js/145.0fe3cd59.js"><link rel="prefetch" href="/assets/js/146.cabf0d13.js"><link rel="prefetch" href="/assets/js/147.41e37bae.js"><link rel="prefetch" href="/assets/js/148.1aff1942.js"><link rel="prefetch" href="/assets/js/149.43ddd51d.js"><link rel="prefetch" href="/assets/js/15.34674cd6.js"><link rel="prefetch" href="/assets/js/150.2dcc7e56.js"><link rel="prefetch" href="/assets/js/151.8267fcff.js"><link rel="prefetch" href="/assets/js/152.19aac962.js"><link rel="prefetch" href="/assets/js/153.90c26683.js"><link rel="prefetch" href="/assets/js/155.fcfefbc5.js"><link rel="prefetch" href="/assets/js/156.8d837db5.js"><link rel="prefetch" href="/assets/js/157.347109ba.js"><link rel="prefetch" href="/assets/js/158.ad5d15c7.js"><link rel="prefetch" href="/assets/js/159.fa03b2bf.js"><link rel="prefetch" href="/assets/js/16.119e91d4.js"><link rel="prefetch" href="/assets/js/160.77c40a45.js"><link rel="prefetch" href="/assets/js/161.bc50d184.js"><link rel="prefetch" href="/assets/js/162.6eb99077.js"><link rel="prefetch" href="/assets/js/163.7daf038b.js"><link rel="prefetch" href="/assets/js/164.29a5a4a0.js"><link rel="prefetch" href="/assets/js/165.2158f290.js"><link rel="prefetch" href="/assets/js/166.7edeee8d.js"><link rel="prefetch" href="/assets/js/167.7fba076e.js"><link rel="prefetch" href="/assets/js/168.aee92853.js"><link rel="prefetch" href="/assets/js/169.f1c69f9e.js"><link rel="prefetch" href="/assets/js/17.780050f1.js"><link rel="prefetch" href="/assets/js/170.c3db9ca3.js"><link rel="prefetch" href="/assets/js/171.39f16573.js"><link rel="prefetch" href="/assets/js/172.854c26f8.js"><link rel="prefetch" href="/assets/js/173.7ac7eb22.js"><link rel="prefetch" href="/assets/js/174.8b371e6b.js"><link rel="prefetch" href="/assets/js/175.2ea22ad4.js"><link rel="prefetch" href="/assets/js/176.342164c7.js"><link rel="prefetch" href="/assets/js/177.ca5f8796.js"><link rel="prefetch" href="/assets/js/178.b191bdb8.js"><link rel="prefetch" href="/assets/js/179.976e6278.js"><link rel="prefetch" href="/assets/js/18.053933da.js"><link rel="prefetch" href="/assets/js/180.aedfb4ca.js"><link rel="prefetch" href="/assets/js/181.e5449166.js"><link rel="prefetch" href="/assets/js/182.903ca4cf.js"><link rel="prefetch" href="/assets/js/183.f2506256.js"><link rel="prefetch" href="/assets/js/184.07b6cfc7.js"><link rel="prefetch" href="/assets/js/185.e92dcf96.js"><link rel="prefetch" href="/assets/js/186.e17f8c1c.js"><link rel="prefetch" href="/assets/js/187.99170016.js"><link rel="prefetch" href="/assets/js/188.90581d2f.js"><link rel="prefetch" href="/assets/js/189.0e1a3abe.js"><link rel="prefetch" href="/assets/js/19.910fc8d0.js"><link rel="prefetch" href="/assets/js/190.41b9ccd3.js"><link rel="prefetch" href="/assets/js/191.4add1d16.js"><link rel="prefetch" href="/assets/js/192.b2cb6399.js"><link rel="prefetch" href="/assets/js/193.b4035cf0.js"><link rel="prefetch" href="/assets/js/194.aca90bf6.js"><link rel="prefetch" href="/assets/js/195.6fa13ccd.js"><link rel="prefetch" href="/assets/js/196.269c7fdd.js"><link rel="prefetch" href="/assets/js/197.9c2db328.js"><link rel="prefetch" href="/assets/js/198.9e158af1.js"><link rel="prefetch" href="/assets/js/199.72ae3d2d.js"><link rel="prefetch" href="/assets/js/20.e8c8408a.js"><link rel="prefetch" href="/assets/js/200.2b7692a5.js"><link rel="prefetch" href="/assets/js/201.47c19701.js"><link rel="prefetch" href="/assets/js/202.c234220d.js"><link rel="prefetch" href="/assets/js/203.238a75d6.js"><link rel="prefetch" href="/assets/js/204.71c0bf86.js"><link rel="prefetch" href="/assets/js/21.287aba19.js"><link rel="prefetch" href="/assets/js/22.f4b7a74b.js"><link rel="prefetch" href="/assets/js/23.fa51555f.js"><link rel="prefetch" href="/assets/js/24.cd8d9d78.js"><link rel="prefetch" href="/assets/js/25.a9fce161.js"><link rel="prefetch" href="/assets/js/26.e3067144.js"><link rel="prefetch" href="/assets/js/27.0610f28c.js"><link rel="prefetch" href="/assets/js/28.f1b496e3.js"><link rel="prefetch" href="/assets/js/29.ef58c202.js"><link rel="prefetch" href="/assets/js/3.970a66a4.js"><link rel="prefetch" href="/assets/js/30.ae297928.js"><link rel="prefetch" href="/assets/js/31.4fd0d93b.js"><link rel="prefetch" href="/assets/js/32.07e772d9.js"><link rel="prefetch" href="/assets/js/33.8045f864.js"><link rel="prefetch" href="/assets/js/34.295422ff.js"><link rel="prefetch" href="/assets/js/35.39e60c42.js"><link rel="prefetch" href="/assets/js/36.fddd48a5.js"><link rel="prefetch" href="/assets/js/37.367a54b5.js"><link rel="prefetch" href="/assets/js/38.a612debc.js"><link rel="prefetch" href="/assets/js/39.94b70e03.js"><link rel="prefetch" href="/assets/js/40.b4ed34c8.js"><link rel="prefetch" href="/assets/js/41.390ffe47.js"><link rel="prefetch" href="/assets/js/42.55e09873.js"><link rel="prefetch" href="/assets/js/43.8065223a.js"><link rel="prefetch" href="/assets/js/44.786fa232.js"><link rel="prefetch" href="/assets/js/45.89a5cd81.js"><link rel="prefetch" href="/assets/js/46.74ac226f.js"><link rel="prefetch" href="/assets/js/47.3bc4cde3.js"><link rel="prefetch" href="/assets/js/48.4ee9fba2.js"><link rel="prefetch" href="/assets/js/49.02a5f0f0.js"><link rel="prefetch" href="/assets/js/5.d1da013e.js"><link rel="prefetch" href="/assets/js/50.5bffa682.js"><link rel="prefetch" href="/assets/js/51.51580cbc.js"><link rel="prefetch" href="/assets/js/52.e69de275.js"><link rel="prefetch" href="/assets/js/53.326a7442.js"><link rel="prefetch" href="/assets/js/54.222addc9.js"><link rel="prefetch" href="/assets/js/55.bd4d5a38.js"><link rel="prefetch" href="/assets/js/56.e14027f4.js"><link rel="prefetch" href="/assets/js/57.949f3da5.js"><link rel="prefetch" href="/assets/js/58.f45aeb0d.js"><link rel="prefetch" href="/assets/js/59.a537c130.js"><link rel="prefetch" href="/assets/js/6.9bdf2d86.js"><link rel="prefetch" href="/assets/js/60.17850c9d.js"><link rel="prefetch" href="/assets/js/61.a9f91faa.js"><link rel="prefetch" href="/assets/js/62.24f5a40d.js"><link rel="prefetch" href="/assets/js/63.60a38d5b.js"><link rel="prefetch" href="/assets/js/64.ecda83e6.js"><link rel="prefetch" href="/assets/js/65.5ac936d7.js"><link rel="prefetch" href="/assets/js/66.ae14e9b3.js"><link rel="prefetch" href="/assets/js/67.6f7c9f8c.js"><link rel="prefetch" href="/assets/js/68.006a7e36.js"><link rel="prefetch" href="/assets/js/69.9d3a3878.js"><link rel="prefetch" href="/assets/js/7.9ac2367b.js"><link rel="prefetch" href="/assets/js/70.4a3f6622.js"><link rel="prefetch" href="/assets/js/71.6d7fab1a.js"><link rel="prefetch" href="/assets/js/72.fab91def.js"><link rel="prefetch" href="/assets/js/73.d791feee.js"><link rel="prefetch" href="/assets/js/74.2801f4e5.js"><link rel="prefetch" href="/assets/js/75.981b86e2.js"><link rel="prefetch" href="/assets/js/76.6241dd05.js"><link rel="prefetch" href="/assets/js/77.da0cc43e.js"><link rel="prefetch" href="/assets/js/78.bf5853c2.js"><link rel="prefetch" href="/assets/js/79.112a39ee.js"><link rel="prefetch" href="/assets/js/8.6b13a443.js"><link rel="prefetch" href="/assets/js/80.f2ed7194.js"><link rel="prefetch" href="/assets/js/81.4b4b8b2f.js"><link rel="prefetch" href="/assets/js/82.65bb49d8.js"><link rel="prefetch" href="/assets/js/83.80cc0629.js"><link rel="prefetch" href="/assets/js/84.f8c4a382.js"><link rel="prefetch" href="/assets/js/85.09c8c91b.js"><link rel="prefetch" href="/assets/js/86.1ff26044.js"><link rel="prefetch" href="/assets/js/87.79d46ddd.js"><link rel="prefetch" href="/assets/js/88.d7051ae9.js"><link rel="prefetch" href="/assets/js/89.ceed231e.js"><link rel="prefetch" href="/assets/js/90.cb5b9f7e.js"><link rel="prefetch" href="/assets/js/91.4c76179c.js"><link rel="prefetch" href="/assets/js/92.f68b9b5c.js"><link rel="prefetch" href="/assets/js/93.f9f451c7.js"><link rel="prefetch" href="/assets/js/94.38528942.js"><link rel="prefetch" href="/assets/js/95.41439023.js"><link rel="prefetch" href="/assets/js/96.bff3c86e.js"><link rel="prefetch" href="/assets/js/97.b6ad2632.js"><link rel="prefetch" href="/assets/js/98.9157217b.js"><link rel="prefetch" href="/assets/js/99.9fedc5bd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1f33e7c2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/author/" class="nav-link">Author</a></div><div class="nav-item"><a href="/articles/" class="nav-link">Blog</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/author/" class="nav-link">Author</a></div><div class="nav-item"><a href="/articles/" class="nav-link">Blog</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>How YOU can Learn Mock testing in .NET Core and C# with Moq</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/dotnet-moq.html#references" class="sidebar-link">References</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/dotnet-moq.html#why-test" class="sidebar-link">Why test</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/dotnet-moq.html#what-to-test" class="sidebar-link">What to test</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/dotnet-moq.html#demo-let-s-test-it" class="sidebar-link">Demo - let's test it</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/dotnet-moq.html#creating-the-code" class="sidebar-link">Creating the code</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/dotnet-moq.html#the-api-project" class="sidebar-link">The API project</a></li><li class="sidebar-sub-header"><a href="/pages/dotnet-moq.html#creating-a-test-project" class="sidebar-link">Creating a test project</a></li></ul></li><li><a href="/pages/dotnet-moq.html#moq-how-it-works" class="sidebar-link">Moq, how it works</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/dotnet-moq.html#creating-our-first-mock" class="sidebar-link">Creating our first Mock</a></li><li class="sidebar-sub-header"><a href="/pages/dotnet-moq.html#instruct-our-mock" class="sidebar-link">Instruct our Mock</a></li><li class="sidebar-sub-header"><a href="/pages/dotnet-moq.html#accessing-our-implementation" class="sidebar-link">Accessing our implementation</a></li></ul></li><li><a href="/pages/dotnet-moq.html#add-unit-tests" class="sidebar-link">Add unit tests</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/dotnet-moq.html#arrange" class="sidebar-link">Arrange</a></li><li class="sidebar-sub-header"><a href="/pages/dotnet-moq.html#act" class="sidebar-link">Act</a></li><li class="sidebar-sub-header"><a href="/pages/dotnet-moq.html#assert" class="sidebar-link">Assert</a></li></ul></li><li><a href="/pages/dotnet-moq.html#a-second-test" class="sidebar-link">A second test</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/dotnet-moq.html#arrange-2" class="sidebar-link">Arrange</a></li><li class="sidebar-sub-header"><a href="/pages/dotnet-moq.html#act-2" class="sidebar-link">Act</a></li><li class="sidebar-sub-header"><a href="/pages/dotnet-moq.html#assert-2" class="sidebar-link">Assert</a></li></ul></li><li><a href="/pages/dotnet-moq.html#full-code" class="sidebar-link">Full code</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/dotnet-moq.html#final-thoughts" class="sidebar-link">Final thoughts</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/dotnet-moq.html#summary" class="sidebar-link">Summary</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="how-you-can-learn-mock-testing-in-net-core-and-c-with-moq"><a href="#how-you-can-learn-mock-testing-in-net-core-and-c-with-moq" aria-hidden="true" class="header-anchor">#</a> How YOU can Learn Mock testing in .NET Core and C# with Moq</h1> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/bzxrw1zmn3lowyd62254.jpg" alt=""></p> <p>Follow me on <a href="https://twitter.com/chris_noring" target="_blank" rel="noopener noreferrer">Twitter<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, happy to take your suggestions on topics or improvements /Chris</p> <blockquote><p>When we test we just want to test one thing - the business logic of the method. Often our method needs the help of dependencies to be able to carry out its job properly. Depending on what these dependencies answer - there might be several paths through a method. So what is Mock testing? It's about testing only one thing, in isolation, by mocking how your dependencies should behave.</p></blockquote> <p>In this article we will cover the following:</p> <ul><li><strong>Why test</strong>, it's important to understand why we test our code. Is it to ensure our code works? Or maybe we are adding tests for defensive reasons so that future refactors don't mess up the business logic?</li> <li><strong>What to test</strong>, normally this question has many answers. We want to ensure that our method does what it says it does, e.g <code>1+1</code> equals <code>2</code>. We might also want to ensure that we test all the different paths through the method, the <em>happy path</em> as well as alternate/erroneous paths. Lastly, we might want to assert that a certain <em>behavior</em> takes place.</li> <li><strong>Demo</strong>, let's write some code that has more than one execution path and introduce the Mocking library <code>Moq</code> and see how it can help us fulfill the above.</li></ul> <h2 id="references"><a href="#references" aria-hidden="true" class="header-anchor">#</a> References</h2> <ul><li><p><a href="https://docs.microsoft.com/dotnet/core/testing/unit-testing-with-dotnet-test?wt.mc_id=academic-0000-chnoring" target="_blank" rel="noopener noreferrer">xUnit testing<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
This page describes how to use xUnit with .Net Core</p></li> <li><p><a href="https://docs.microsoft.com/dotnet/core/testing/unit-testing-with-nunit?wt.mc_id=academic-0000-chnoring" target="_blank" rel="noopener noreferrer">nUnit testing<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
This page describes how to use nUnit with .Net Core.</p></li> <li><p><a href="https://docs.microsoft.com/dotnet/core/tools/dotnet-test?tabs=netcore21?wt.mc_id=academic-0000-chnoring" target="_blank" rel="noopener noreferrer">dotnet test, terminal command description<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
This page describes the terminal command <code>dotnet test</code> and all the different arguments you can call it with.</p></li> <li><p><a href="https://docs.microsoft.comdotnet/core/testing/selective-unit-tests?wt.mc_id=academic-0000-chnoring" target="_blank" rel="noopener noreferrer">dotnet selective test<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
This page describes how to do selective testing and how to set up filters and query using filters.</p></li> <li><p><a href="https://docs.microsoft.com/dotnet/core/tutorials/with-visual-studio-code?wt.mc_id=academic-0000-chnoring" target="_blank" rel="noopener noreferrer">Get started with C# and VS Code<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://dev.to/softchris/net-core-series-learning-net-core-on-vs-code-and-how-you-can-create-a-serverless-api-4jep" target="_blank" rel="noopener noreferrer">.Net Core Series on NuGet, Serverless and much more<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://github.com/Moq/moq4/wiki/Quickstart" target="_blank" rel="noopener noreferrer">Moq tutorial<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
This is the GitHub repo for the Moq library. The README contains a tutorial.</p></li></ul> <h2 id="why-test"><a href="#why-test" aria-hidden="true" class="header-anchor">#</a> Why test</h2> <p>As we mentioned already there are many answers to this question. So how do we know? Well, I usually see the following reasons:</p> <ul><li><strong>Ensuring Quality</strong>, because I'm not an all-knowing being I will make mistakes. Writing tests ensures that at least the worst mistakes are avoided.</li> <li><strong>Is my code testable</strong>, before I've written tests for my code it might be hard to tell whether it lends itself to be tested. Of course, I need to ask myself at this point whether this code should be tested. My advice here if it's not obvious what running the method will produce or if there is more than one execution path - it should be tested.</li> <li><strong>Being defensive</strong>, you have a tendency to maintain software over several years. The people doing the maintaining might be you or someone else. One way to communicate what code is important is to write tests that absolutely should work regardless of what refactorings you, or anyone else, attempts to carry out.</li> <li><strong>Documentation</strong>, documentation sounds like a good idea at first but we all know that out of sync documentation is worse than no documentation. For that reason, we tend to not write it in the first place, or maybe feel ok with high-level documentation only or rely on tools like Swagger for example. Believe it or not but tests are usually really good documentation. It's one developer to another saying, <em>this is how I think the code should be used</em>. So for the sake of that future maintainer, communicate what your intentions were/are.</li></ul> <h2 id="what-to-test"><a href="#what-to-test" aria-hidden="true" class="header-anchor">#</a> What to test</h2> <p>So what should we test? Well, my first response here is all the paths through the method. The happy path as well as alternate paths.</p> <p>My second response is to understand whether we are testing a function to produce a certain result like <code>1+1</code> equals <code>2</code> or whether it's more a <em>behavior</em> like - we should have been paid before we can ship the items in the cart.</p> <h2 id="demo-let-s-test-it"><a href="#demo-let-s-test-it" aria-hidden="true" class="header-anchor">#</a> Demo - let's test it</h2> <p>What are we doing? Well, we have talked repeatedly about that Shopping Cart in an e-commerce application so let's use that as an example for our demo.</p> <p>This is clearly a case of <em>behavior</em> testing. We want the Cart items to be shipped to a customer providing we got paid. That means we need to verify that the payment is carried out correctly and we also need a way to assert what happens if the payment fails.</p> <p>We will need the following:</p> <ul><li><strong>A <code>CartController</code></strong>, will contain logic such as trying to get paid for a cart's content. If we are successfully paid then ship the items in the cart to a specified address.</li> <li><strong>Helper services</strong>, we need a few helper services to figure this out like:
<ul><li><code>ICartService</code>, this should help us calculate how much the items in cart costs but also tell us exactly what the content is so we can send this out to a customer once we have gotten paid.</li> <li><code>IPaymentService</code>, this should charge a card with a specified sum</li> <li><code>IShipmentService</code>, this should be able to ship the cart content to a specific address</li></ul></li></ul> <h2 id="creating-the-code"><a href="#creating-the-code" aria-hidden="true" class="header-anchor">#</a> Creating the code</h2> <p>We will need two different .NET Core projects for this:</p> <ul><li><strong>a webapi project</strong>, this should contain our production code and carry out the business logic as stated by the <code>CartController</code> and its helper services.</li> <li><strong>a test project</strong>, this project will contain all the tests and a reference to the above project.</li></ul> <h3 id="the-api-project"><a href="#the-api-project" aria-hidden="true" class="header-anchor">#</a> The API project</h3> <p>For this project, this could be either an app using the template <code>mvc</code>, <code>webapp</code> or <code>webapi</code></p> <p>First, let's create a solution. Create a directory like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>mkdir &lt;new directory name&gt;
cd &lt;new directory name&gt;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Thereafter create a new solution like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>dotnet new sln
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>To create our API project we just need to instantiate it like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>dotnet new webapi -o api
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>and lastly add it to the solution like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>dotnet sln add api/api.csproj
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>Controllers/CartController.cs</strong></p> <p>Add the file <code>CartController.cs</code> under the directory <code>Controllers</code> and give it the following content:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> System<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Linq<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>AspNetCore<span class="token punctuation">.</span>Mvc<span class="token punctuation">;</span>
<span class="token keyword">using</span> Services<span class="token punctuation">;</span>

<span class="token keyword">namespace</span> api<span class="token punctuation">.</span>Controllers
<span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token class-name">ApiController</span><span class="token punctuation">]</span>
  <span class="token punctuation">[</span><span class="token class-name">Route</span><span class="token punctuation">(</span><span class="token string">&quot;[controller]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CartController</span> 
  <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">ICartService</span> _cartService<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IPaymentService</span> _paymentService<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IShipmentService</span> _shipmentService<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token function">CartController</span><span class="token punctuation">(</span>
      <span class="token class-name">ICartService</span> cartService<span class="token punctuation">,</span>
      <span class="token class-name">IPaymentService</span> paymentService<span class="token punctuation">,</span>
      <span class="token class-name">IShipmentService</span> shipmentService
    <span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
      _cartService <span class="token operator">=</span> cartService<span class="token punctuation">;</span>
      _paymentService <span class="token operator">=</span> paymentService<span class="token punctuation">;</span>
      _shipmentService <span class="token operator">=</span> shipmentService<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token class-name">HttpPost</span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> <span class="token function">CheckOut</span><span class="token punctuation">(</span><span class="token class-name">ICard</span> card<span class="token punctuation">,</span> <span class="token class-name">IAddressInfo</span> addressInfo<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        <span class="token keyword">var</span> result <span class="token operator">=</span> _paymentService<span class="token punctuation">.</span><span class="token function">Charge</span><span class="token punctuation">(</span>_cartService<span class="token punctuation">.</span><span class="token function">Total</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> card<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            _shipmentService<span class="token punctuation">.</span><span class="token function">Ship</span><span class="token punctuation">(</span>addressInfo<span class="token punctuation">,</span> _cartService<span class="token punctuation">.</span><span class="token function">Items</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token string">&quot;charged&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token string">&quot;not charged&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>Ok, our controller is created but it has quite a few dependencies in place that we need to create namely <code>ICartService</code>, <code>IPaymentService</code> and <code>IShipmentService</code>.</p> <p>Note how we will not create any concrete implementations of our services at this point. We are more interested in establishing and testing the behavior of our code. That means that concrete service implementations can come later.</p> <p><strong>Services/ICartService.cs</strong></p> <p>Create the file <code>ICartService.cs</code> under the directory <code>Services</code> and give it the following content:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">namespace</span> Services 
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ICartService</span> 
  <span class="token punctuation">{</span>
    <span class="token keyword">double</span> <span class="token function">Total</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    IEnumerable<span class="token operator">&lt;</span>CartItem<span class="token operator">&gt;</span> <span class="token function">Items</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>This interface is just a representation of a shopping cart and is able to tell us what is in the cart through the method <code>Items()</code> and how to calculate its total value through the method <code>Total()</code>.</p> <p><strong>Services/IPaymentService.cs</strong></p> <p>Let's create the file <code>IPaymentService.cs</code> in the directory <code>Services</code> and give it the following content:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">namespace</span> Services 
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IPaymentService</span> 
  <span class="token punctuation">{</span>
    <span class="token keyword">bool</span> <span class="token function">Charge</span><span class="token punctuation">(</span><span class="token keyword">double</span> total<span class="token punctuation">,</span> <span class="token class-name">ICard</span> card<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Now we have a payment service that is able to take <code>total</code> for the amount to be charged and <code>card</code> which is debit/credit card that contains all the needed information to be charged.</p> <p><strong>Services/IShipmentService.cs</strong></p> <p>For our last service let's create the file <code>IShipmentService.cs</code> under the directory <code>Services</code> with the following content:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> System<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Generic<span class="token punctuation">;</span>

<span class="token keyword">namespace</span> Services
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IShipmentService</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">Ship</span><span class="token punctuation">(</span><span class="token class-name">IAddressInfo</span> info<span class="token punctuation">,</span> IEnumerable<span class="token operator">&lt;</span>CartItem<span class="token operator">&gt;</span> items<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>This contains a method <code>Ship()</code> that will allow us to ship a cart's content to the customer.</p> <p><strong>Services/Models.cs</strong></p> <p>Create the file <code>Models.cs</code> in the directory <code>Services</code> with the following content:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">namespace</span> Services 
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IAddressInfo</span> 
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> Street <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> Address <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> City <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> PostalCode <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> PhoneNumber <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ICard</span> 
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> CardNumber <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">DateTime</span> ValidTo <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CartItem</span> 
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> ProductId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> Quantity <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> Price<span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>This contains some supporting interfaces that we need for our services.</p> <h3 id="creating-a-test-project"><a href="#creating-a-test-project" aria-hidden="true" class="header-anchor">#</a> Creating a test project</h3> <p>Our test project is interested in testing the behavior of <code>CartController</code>. First off we will need a test project. There are quite a few test templates supported in .NET Core like <code>nunit</code>, <code>xunit</code> and <code>mstest</code>. We'll go with <code>nunit</code>.</p> <p>To create our test project we type:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>dotnet new nunit -o api.test
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Let's add it to the solution like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>dotnet sln add test/test.csproj
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Thereafter add a reference of the API project to the test project, so we are able to test the API project:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>dotnet add test/test.csproj reference api/api.csproj
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Finally, we need to install our mocking library <code>moq</code>, with the following command:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>dotnet add package moq
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="moq-how-it-works"><a href="#moq-how-it-works" aria-hidden="true" class="header-anchor">#</a> Moq, how it works</h2> <p>Let's talk quickly about our Mock library <code>moq</code>. The idea is to create a concrete implementation of an interface and control how certain methods on that interface responds when called. This will allow us to essentially test all of the paths through code.</p> <h3 id="creating-our-first-mock"><a href="#creating-our-first-mock" aria-hidden="true" class="header-anchor">#</a> Creating our first Mock</h3> <p>Let's create our first Mock with the following code:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">var</span> paymentServiceMock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token generic-method"><span class="token function">Mock</span><span class="token punctuation">&lt;</span><span class="token class-name">IPaymentService</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The above is not a concrete implementation but a Mock object. A Mock can be:</p> <ul><li><strong>Instructed</strong>, you can tell a mock that if a certain method is called then it can answer with a certain response</li> <li><strong>Verified</strong>, verification is something you carry out after your production code has been called. You carry this out to verify that a certain method has been called with specific arguments</li></ul> <h3 id="instruct-our-mock"><a href="#instruct-our-mock" aria-hidden="true" class="header-anchor">#</a> Instruct our Mock</h3> <p>Now we have a Mock object that we can instruct. To instruct it we use the method <code>Setup()</code> like so:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>paymentServiceMock<span class="token punctuation">.</span><span class="token function">Setup</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span><span class="token function">Charge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Returns</span><span class="token punctuation">(</span><span class="token keyword">true</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Of course, the above won't compile, we need to give the <code>Charge()</code> method the arguments it needs. There are two ways we can give the <code>Charge()</code> method the arguments it needs:</p> <ol><li>Exact arguments, this is when we give it some concrete values like so:</li></ol> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">var</span> card <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Card</span><span class="token punctuation">(</span><span class="token string">&quot;owner&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;CVV number&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

paymentServiceMock<span class="token punctuation">.</span><span class="token function">Setup</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span><span class="token function">Charge</span><span class="token punctuation">(</span><span class="token number">114</span><span class="token punctuation">,</span>card<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Returns</span><span class="token punctuation">(</span><span class="token keyword">true</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="2"><li>General arguments, here we can use the helper <code>It</code>, which will allow us to instruct the method <code>Charge()</code> that <em>any</em> values of a certain data type can be passed through:</li></ol> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>paymentServiceMock<span class="token punctuation">.</span><span class="token function">Setup</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span><span class="token function">Charge</span><span class="token punctuation">(</span>It<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">IsAny</span><span class="token punctuation">&lt;</span><span class="token keyword">double</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>card<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Returns</span><span class="token punctuation">(</span><span class="token keyword">true</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="accessing-our-implementation"><a href="#accessing-our-implementation" aria-hidden="true" class="header-anchor">#</a> Accessing our implementation</h3> <p>We will need to pass an implementation of our Mock when we call the actual production code. So how do we do that? There's an <code>Object</code> property on the Mock that represents the concrete implementation. Below we are using just that. We first construct <code>cardMock</code> and then we pass <code>cardMock.Object</code> to the <code>Charge()</code> method.</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">var</span> cardMock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token generic-method"><span class="token function">Mock</span><span class="token punctuation">&lt;</span><span class="token class-name">ICard</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

paymentServiceMock<span class="token punctuation">.</span><span class="token function">Setup</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span><span class="token function">Charge</span><span class="token punctuation">(</span>It<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">IsAny</span><span class="token punctuation">&lt;</span><span class="token keyword">double</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>cardMock<span class="token punctuation">.</span>Object<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Returns</span><span class="token punctuation">(</span><span class="token keyword">true</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="add-unit-tests"><a href="#add-unit-tests" aria-hidden="true" class="header-anchor">#</a> Add unit tests</h2> <p>Let's rename the default test file we got to <code>CartControllerTest.cs</code>. Next, let's discuss our approach. We want to:</p> <ul><li><strong>Test all the execution paths</strong>, there are currently two different paths through our CartController depending on whether <code>_paymentService.Charge()</code> answers with <code>true</code> or <code>false</code></li> <li><strong>Write two tests</strong>, we need at least two different tests, one for each execution path</li> <li><strong>Assert</strong>, we need to ensure that the <em>correct</em> thing happens. In our case, that means if we successfully get paid then we should ship, so that means asserting that the <code>shipmentService</code> is being called.</li></ul> <p>Let's write our first test:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// CartControllerTest.cs</span>

<span class="token punctuation">[</span><span class="token class-name">Test</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ShouldReturnCharged</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token comment">// arrange</span>
  paymentServiceMock<span class="token punctuation">.</span><span class="token function">Setup</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span><span class="token function">Charge</span><span class="token punctuation">(</span>It<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">IsAny</span><span class="token punctuation">&lt;</span><span class="token keyword">double</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cardMock<span class="token punctuation">.</span>Object<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Returns</span><span class="token punctuation">(</span><span class="token keyword">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// act</span>
  <span class="token keyword">var</span> result <span class="token operator">=</span> controller<span class="token punctuation">.</span><span class="token function">CheckOut</span><span class="token punctuation">(</span>cardMock<span class="token punctuation">.</span>Object<span class="token punctuation">,</span> addressInfoMock<span class="token punctuation">.</span>Object<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// assert</span>
  shipmentServiceMock<span class="token punctuation">.</span><span class="token function">Verify</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">Ship</span><span class="token punctuation">(</span>addressInfoMock<span class="token punctuation">.</span>Object<span class="token punctuation">,</span> items<span class="token punctuation">.</span><span class="token function">AsEnumerable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Times<span class="token punctuation">.</span><span class="token function">Once</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  Assert<span class="token punctuation">.</span><span class="token function">AreEqual</span><span class="token punctuation">(</span><span class="token string">&quot;charged&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>We have three phases above.</p> <h3 id="arrange"><a href="#arrange" aria-hidden="true" class="header-anchor">#</a> Arrange</h3> <p>Let's have a look at the code:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>paymentServiceMock<span class="token punctuation">.</span><span class="token function">Setup</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span><span class="token function">Charge</span><span class="token punctuation">(</span>It<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">IsAny</span><span class="token punctuation">&lt;</span><span class="token keyword">double</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cardMock<span class="token punctuation">.</span>Object<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Returns</span><span class="token punctuation">(</span><span class="token keyword">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>here we are setting things up and saying that if our <code>paymentService.Charge()</code> method is called with any value <code>It.IsAny&lt;double&gt;()</code> and with a card object <code>cardMock.Object</code> then we should return <code>true</code>, aka <code>.Returns(true)</code>. This means we have set up a happy path and are ready to go to the next phase <em>Act</em>.</p> <h3 id="act"><a href="#act" aria-hidden="true" class="header-anchor">#</a> Act</h3> <p>Here we call the actual code:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">var</span> result <span class="token operator">=</span> controller<span class="token punctuation">.</span><span class="token function">CheckOut</span><span class="token punctuation">(</span>cardMock<span class="token punctuation">.</span>Object<span class="token punctuation">,</span> addressInfoMock<span class="token punctuation">.</span>Object<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>As we can see above we get the answer assigned to the variable <code>result</code>. This takes us to our next phase, <em>Assert</em>.</p> <h3 id="assert"><a href="#assert" aria-hidden="true" class="header-anchor">#</a> Assert</h3> <p>Let's have a look at the code:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>shipmentServiceMock<span class="token punctuation">.</span><span class="token function">Verify</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">Ship</span><span class="token punctuation">(</span>addressInfoMock<span class="token punctuation">.</span>Object<span class="token punctuation">,</span> items<span class="token punctuation">.</span><span class="token function">AsEnumerable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Times<span class="token punctuation">.</span><span class="token function">Once</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Assert<span class="token punctuation">.</span><span class="token function">AreEqual</span><span class="token punctuation">(</span><span class="token string">&quot;charged&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Now, there are two pieces of assertions that take place here. First, we have a Mock assertion. We see that as we are calling the method <code>Verify()</code> that essentially says: I expect the <code>Ship()</code> method to have been called with an <code>addressInfo</code> object and a <code>cartItem</code> list and that it was called only once. That all seems reasonable, our <code>paymentService</code> says it was paid, we set it up to respond <code>true</code>.</p> <p>Next, we have a more normal-looking assertion namely this code:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Assert.AreEqual(&quot;charged&quot;, result);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>It says our <code>result</code> variable should contain the value <code>charged</code>.</p> <h2 id="a-second-test"><a href="#a-second-test" aria-hidden="true" class="header-anchor">#</a> A second test</h2> <p>So far we tested the happy path. As we stated earlier, there are two paths through this code. The <code>paymentService</code> could decline our payment and then we shouldn't ship any cart content. Let's see what the code looks like for that:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>
<span class="token punctuation">[</span><span class="token class-name">Test</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ShouldReturnNotCharged</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token comment">// arrange</span>
    paymentServiceMock<span class="token punctuation">.</span><span class="token function">Setup</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span><span class="token function">Charge</span><span class="token punctuation">(</span>It<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">IsAny</span><span class="token punctuation">&lt;</span><span class="token keyword">double</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cardMock<span class="token punctuation">.</span>Object<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Returns</span><span class="token punctuation">(</span><span class="token keyword">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// act</span>
    <span class="token keyword">var</span> result <span class="token operator">=</span> controller<span class="token punctuation">.</span><span class="token function">CheckOut</span><span class="token punctuation">(</span>cardMock<span class="token punctuation">.</span>Object<span class="token punctuation">,</span> addressInfoMock<span class="token punctuation">.</span>Object<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// assert</span>
    shipmentServiceMock<span class="token punctuation">.</span><span class="token function">Verify</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">Ship</span><span class="token punctuation">(</span>addressInfoMock<span class="token punctuation">.</span>Object<span class="token punctuation">,</span> items<span class="token punctuation">.</span><span class="token function">AsEnumerable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Times<span class="token punctuation">.</span><span class="token function">Never</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Assert<span class="token punctuation">.</span><span class="token function">AreEqual</span><span class="token punctuation">(</span><span class="token string">&quot;not charged&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>Above we see that we have again the three phases <em>Arrange</em>, <em>Act</em> and <em>Assert</em>.</p> <h3 id="arrange-2"><a href="#arrange-2" aria-hidden="true" class="header-anchor">#</a> Arrange</h3> <p>This time around we are ensuring that our <code>paymentService</code> mock is returning <code>false</code>, aka payment bounced.</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>paymentServiceMock<span class="token punctuation">.</span><span class="token function">Setup</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span><span class="token function">Charge</span><span class="token punctuation">(</span>It<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">IsAny</span><span class="token punctuation">&lt;</span><span class="token keyword">double</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cardMock<span class="token punctuation">.</span>Object<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Returns</span><span class="token punctuation">(</span><span class="token keyword">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="act-2"><a href="#act-2" aria-hidden="true" class="header-anchor">#</a> Act</h3> <p>This part looks exactly the same:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">var</span> result <span class="token operator">=</span> controller<span class="token punctuation">.</span><span class="token function">CheckOut</span><span class="token punctuation">(</span>cardMock<span class="token punctuation">.</span>Object<span class="token punctuation">,</span> addressInfoMock<span class="token punctuation">.</span>Object<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="assert-2"><a href="#assert-2" aria-hidden="true" class="header-anchor">#</a> Assert</h3> <p>We are still testing two pieces of assertions - behavior and value assertion:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>shipmentServiceMock<span class="token punctuation">.</span><span class="token function">Verify</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">Ship</span><span class="token punctuation">(</span>addressInfoMock<span class="token punctuation">.</span>Object<span class="token punctuation">,</span> items<span class="token punctuation">.</span><span class="token function">AsEnumerable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Times<span class="token punctuation">.</span><span class="token function">Never</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Assert<span class="token punctuation">.</span><span class="token function">AreEqual</span><span class="token punctuation">(</span><span class="token string">&quot;not charged&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Looking at the code above we, however, are asserting that <code>shipmentService</code> is not called <code>Times.Never()</code>. That's important to verify as that otherwise would lose us money.</p> <p>The second assertion just tests that the <code>result</code> variable now says <code>not charged</code>.</p> <h2 id="full-code"><a href="#full-code" aria-hidden="true" class="header-anchor">#</a> Full code</h2> <p>Let's have a look at the full code so you are able to test this out for yourself:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// CartControllerTest.cs</span>

<span class="token keyword">using</span> System<span class="token punctuation">;</span>
<span class="token keyword">using</span> Services<span class="token punctuation">;</span>
<span class="token keyword">using</span> Moq<span class="token punctuation">;</span>
<span class="token keyword">using</span> NUnit<span class="token punctuation">.</span>Framework<span class="token punctuation">;</span>
<span class="token keyword">using</span> api<span class="token punctuation">.</span>Controllers<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Linq<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic<span class="token punctuation">;</span>

<span class="token keyword">namespace</span> test
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Tests</span>
  <span class="token punctuation">{</span>
      <span class="token keyword">private</span> <span class="token class-name">CartController</span> controller<span class="token punctuation">;</span>
      <span class="token keyword">private</span> Mock<span class="token operator">&lt;</span>IPaymentService<span class="token operator">&gt;</span> paymentServiceMock<span class="token punctuation">;</span>
      <span class="token keyword">private</span> Mock<span class="token operator">&lt;</span>ICartService<span class="token operator">&gt;</span> cartServiceMock<span class="token punctuation">;</span>

      <span class="token keyword">private</span> Mock<span class="token operator">&lt;</span>IShipmentService<span class="token operator">&gt;</span> shipmentServiceMock<span class="token punctuation">;</span>
      <span class="token keyword">private</span> Mock<span class="token operator">&lt;</span>ICard<span class="token operator">&gt;</span> cardMock<span class="token punctuation">;</span>
      <span class="token keyword">private</span> Mock<span class="token operator">&lt;</span>IAddressInfo<span class="token operator">&gt;</span> addressInfoMock<span class="token punctuation">;</span>
      <span class="token keyword">private</span> List<span class="token operator">&lt;</span>CartItem<span class="token operator">&gt;</span> items<span class="token punctuation">;</span>

      <span class="token punctuation">[</span><span class="token class-name">SetUp</span><span class="token punctuation">]</span>
      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
          
          cartServiceMock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token generic-method"><span class="token function">Mock</span><span class="token punctuation">&lt;</span><span class="token class-name">ICartService</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          paymentServiceMock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token generic-method"><span class="token function">Mock</span><span class="token punctuation">&lt;</span><span class="token class-name">IPaymentService</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          shipmentServiceMock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token generic-method"><span class="token function">Mock</span><span class="token punctuation">&lt;</span><span class="token class-name">IShipmentService</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token comment">// arrange</span>
          cardMock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token generic-method"><span class="token function">Mock</span><span class="token punctuation">&lt;</span><span class="token class-name">ICard</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          addressInfoMock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token generic-method"><span class="token function">Mock</span><span class="token punctuation">&lt;</span><span class="token class-name">IAddressInfo</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token comment">// </span>
          <span class="token keyword">var</span> cartItemMock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token generic-method"><span class="token function">Mock</span><span class="token punctuation">&lt;</span><span class="token class-name">CartItem</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          cartItemMock<span class="token punctuation">.</span><span class="token function">Setup</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>Price<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Returns</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          items <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token generic-method"><span class="token function">List</span><span class="token punctuation">&lt;</span><span class="token class-name">CartItem</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">{</span>
              cartItemMock<span class="token punctuation">.</span>Object
          <span class="token punctuation">}</span><span class="token punctuation">;</span>

          cartServiceMock<span class="token punctuation">.</span><span class="token function">Setup</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> c<span class="token punctuation">.</span><span class="token function">Items</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Returns</span><span class="token punctuation">(</span>items<span class="token punctuation">.</span><span class="token function">AsEnumerable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CartController</span><span class="token punctuation">(</span>cartServiceMock<span class="token punctuation">.</span>Object<span class="token punctuation">,</span> paymentServiceMock<span class="token punctuation">.</span>Object<span class="token punctuation">,</span> shipmentServiceMock<span class="token punctuation">.</span>Object<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token punctuation">[</span><span class="token class-name">Test</span><span class="token punctuation">]</span>
      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ShouldReturnCharged</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
          paymentServiceMock<span class="token punctuation">.</span><span class="token function">Setup</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span><span class="token function">Charge</span><span class="token punctuation">(</span>It<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">IsAny</span><span class="token punctuation">&lt;</span><span class="token keyword">double</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cardMock<span class="token punctuation">.</span>Object<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Returns</span><span class="token punctuation">(</span><span class="token keyword">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token comment">// act</span>
          <span class="token keyword">var</span> result <span class="token operator">=</span> controller<span class="token punctuation">.</span><span class="token function">CheckOut</span><span class="token punctuation">(</span>cardMock<span class="token punctuation">.</span>Object<span class="token punctuation">,</span> addressInfoMock<span class="token punctuation">.</span>Object<span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token comment">// assert</span>
          <span class="token comment">// myInterfaceMock.Verify((m =&gt; m.DoesSomething()), Times.Once());</span>
          shipmentServiceMock<span class="token punctuation">.</span><span class="token function">Verify</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">Ship</span><span class="token punctuation">(</span>addressInfoMock<span class="token punctuation">.</span>Object<span class="token punctuation">,</span> items<span class="token punctuation">.</span><span class="token function">AsEnumerable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Times<span class="token punctuation">.</span><span class="token function">Once</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          Assert<span class="token punctuation">.</span><span class="token function">AreEqual</span><span class="token punctuation">(</span><span class="token string">&quot;charged&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token punctuation">[</span><span class="token class-name">Test</span><span class="token punctuation">]</span>
      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ShouldReturnNotCharged</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
      <span class="token punctuation">{</span>
          paymentServiceMock<span class="token punctuation">.</span><span class="token function">Setup</span><span class="token punctuation">(</span>p <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span><span class="token function">Charge</span><span class="token punctuation">(</span>It<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">IsAny</span><span class="token punctuation">&lt;</span><span class="token keyword">double</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cardMock<span class="token punctuation">.</span>Object<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Returns</span><span class="token punctuation">(</span><span class="token keyword">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token comment">// act</span>
          <span class="token keyword">var</span> result <span class="token operator">=</span> controller<span class="token punctuation">.</span><span class="token function">CheckOut</span><span class="token punctuation">(</span>cardMock<span class="token punctuation">.</span>Object<span class="token punctuation">,</span> addressInfoMock<span class="token punctuation">.</span>Object<span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token comment">// assert</span>
          shipmentServiceMock<span class="token punctuation">.</span><span class="token function">Verify</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span> s<span class="token punctuation">.</span><span class="token function">Ship</span><span class="token punctuation">(</span>addressInfoMock<span class="token punctuation">.</span>Object<span class="token punctuation">,</span> items<span class="token punctuation">.</span><span class="token function">AsEnumerable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Times<span class="token punctuation">.</span><span class="token function">Never</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          Assert<span class="token punctuation">.</span><span class="token function">AreEqual</span><span class="token punctuation">(</span><span class="token string">&quot;not charged&quot;</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br></div></div><h2 id="final-thoughts"><a href="#final-thoughts" aria-hidden="true" class="header-anchor">#</a> Final thoughts</h2> <p>So we have managed to test out the two major paths through our code but there are more tests, more assertions we could be doing. For example, we could ensure that the value of the Cart corresponds to what the customer is actually being charged. As well all know in the real world things are more complicated. We might need to update the API code to consider timeouts or errors being thrown from the Shipment service as well as the payment service.</p> <h2 id="summary"><a href="#summary" aria-hidden="true" class="header-anchor">#</a> Summary</h2> <p>I've hopefully been able to convey some good reasons for why you should test your code. Additionally, I hope you think the library <code>moq</code> looks like a good candidate to help you with the more behavioral aspects of your code.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.95c997f3.js" defer></script><script src="/assets/js/9.454b5262.js" defer></script><script src="/assets/js/4.eac68367.js" defer></script><script src="/assets/js/154.11f5eee4.js" defer></script>
  </body>
</html>
