<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>How YOU can use an ORM in .NET Core and C# to type less SQL -starring Entity Framework</title>
    <meta name="description" content="[object Object]">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    
    <link rel="preload" href="/assets/css/0.styles.1f33e7c2.css" as="style"><link rel="preload" href="/assets/js/app.95c997f3.js" as="script"><link rel="preload" href="/assets/js/9.454b5262.js" as="script"><link rel="preload" href="/assets/js/4.eac68367.js" as="script"><link rel="preload" href="/assets/js/156.8d837db5.js" as="script"><link rel="prefetch" href="/assets/js/1.36663999.js"><link rel="prefetch" href="/assets/js/10.6aaebcfe.js"><link rel="prefetch" href="/assets/js/100.f7776fae.js"><link rel="prefetch" href="/assets/js/101.83c4ff25.js"><link rel="prefetch" href="/assets/js/102.d3a51c53.js"><link rel="prefetch" href="/assets/js/103.005176e9.js"><link rel="prefetch" href="/assets/js/104.ad6ac0a2.js"><link rel="prefetch" href="/assets/js/105.1c2918c1.js"><link rel="prefetch" href="/assets/js/106.84577e76.js"><link rel="prefetch" href="/assets/js/107.39206cda.js"><link rel="prefetch" href="/assets/js/108.b717e412.js"><link rel="prefetch" href="/assets/js/109.a0275c41.js"><link rel="prefetch" href="/assets/js/11.e44a9c79.js"><link rel="prefetch" href="/assets/js/110.acd428a7.js"><link rel="prefetch" href="/assets/js/111.85c1f355.js"><link rel="prefetch" href="/assets/js/112.62bab5e5.js"><link rel="prefetch" href="/assets/js/113.30083b82.js"><link rel="prefetch" href="/assets/js/114.2dcc568f.js"><link rel="prefetch" href="/assets/js/115.2ee55351.js"><link rel="prefetch" href="/assets/js/116.44cdb765.js"><link rel="prefetch" href="/assets/js/117.f22ffed2.js"><link rel="prefetch" href="/assets/js/118.fda8edf7.js"><link rel="prefetch" href="/assets/js/119.1ea9eae7.js"><link rel="prefetch" href="/assets/js/12.02e6e552.js"><link rel="prefetch" href="/assets/js/120.cf073939.js"><link rel="prefetch" href="/assets/js/121.d06bb8bc.js"><link rel="prefetch" href="/assets/js/122.533a0953.js"><link rel="prefetch" href="/assets/js/123.382bf140.js"><link rel="prefetch" href="/assets/js/124.1e416617.js"><link rel="prefetch" href="/assets/js/125.88e1d9ef.js"><link rel="prefetch" href="/assets/js/126.ac7f0ed9.js"><link rel="prefetch" href="/assets/js/127.2452b31c.js"><link rel="prefetch" href="/assets/js/128.4387dd5e.js"><link rel="prefetch" href="/assets/js/129.57ea763a.js"><link rel="prefetch" href="/assets/js/13.215ad842.js"><link rel="prefetch" href="/assets/js/130.db7a97a9.js"><link rel="prefetch" href="/assets/js/131.cb028185.js"><link rel="prefetch" href="/assets/js/132.1f53aba9.js"><link rel="prefetch" href="/assets/js/133.3e4f88da.js"><link rel="prefetch" href="/assets/js/134.78b60412.js"><link rel="prefetch" href="/assets/js/135.67d56f81.js"><link rel="prefetch" href="/assets/js/136.5f5c962b.js"><link rel="prefetch" href="/assets/js/137.a4bdc628.js"><link rel="prefetch" href="/assets/js/138.9e4dca1e.js"><link rel="prefetch" href="/assets/js/139.ff87d106.js"><link rel="prefetch" href="/assets/js/14.12340cee.js"><link rel="prefetch" href="/assets/js/140.345c5f56.js"><link rel="prefetch" href="/assets/js/141.7ca86301.js"><link rel="prefetch" href="/assets/js/142.dd05b794.js"><link rel="prefetch" href="/assets/js/143.c0950d2f.js"><link rel="prefetch" href="/assets/js/144.e36983d5.js"><link rel="prefetch" href="/assets/js/145.0fe3cd59.js"><link rel="prefetch" href="/assets/js/146.cabf0d13.js"><link rel="prefetch" href="/assets/js/147.41e37bae.js"><link rel="prefetch" href="/assets/js/148.1aff1942.js"><link rel="prefetch" href="/assets/js/149.43ddd51d.js"><link rel="prefetch" href="/assets/js/15.34674cd6.js"><link rel="prefetch" href="/assets/js/150.2dcc7e56.js"><link rel="prefetch" href="/assets/js/151.8267fcff.js"><link rel="prefetch" href="/assets/js/152.19aac962.js"><link rel="prefetch" href="/assets/js/153.90c26683.js"><link rel="prefetch" href="/assets/js/154.11f5eee4.js"><link rel="prefetch" href="/assets/js/155.fcfefbc5.js"><link rel="prefetch" href="/assets/js/157.347109ba.js"><link rel="prefetch" href="/assets/js/158.ad5d15c7.js"><link rel="prefetch" href="/assets/js/159.fa03b2bf.js"><link rel="prefetch" href="/assets/js/16.119e91d4.js"><link rel="prefetch" href="/assets/js/160.77c40a45.js"><link rel="prefetch" href="/assets/js/161.bc50d184.js"><link rel="prefetch" href="/assets/js/162.6eb99077.js"><link rel="prefetch" href="/assets/js/163.7daf038b.js"><link rel="prefetch" href="/assets/js/164.29a5a4a0.js"><link rel="prefetch" href="/assets/js/165.2158f290.js"><link rel="prefetch" href="/assets/js/166.7edeee8d.js"><link rel="prefetch" href="/assets/js/167.7fba076e.js"><link rel="prefetch" href="/assets/js/168.aee92853.js"><link rel="prefetch" href="/assets/js/169.f1c69f9e.js"><link rel="prefetch" href="/assets/js/17.780050f1.js"><link rel="prefetch" href="/assets/js/170.c3db9ca3.js"><link rel="prefetch" href="/assets/js/171.39f16573.js"><link rel="prefetch" href="/assets/js/172.854c26f8.js"><link rel="prefetch" href="/assets/js/173.7ac7eb22.js"><link rel="prefetch" href="/assets/js/174.8b371e6b.js"><link rel="prefetch" href="/assets/js/175.2ea22ad4.js"><link rel="prefetch" href="/assets/js/176.342164c7.js"><link rel="prefetch" href="/assets/js/177.ca5f8796.js"><link rel="prefetch" href="/assets/js/178.b191bdb8.js"><link rel="prefetch" href="/assets/js/179.976e6278.js"><link rel="prefetch" href="/assets/js/18.053933da.js"><link rel="prefetch" href="/assets/js/180.aedfb4ca.js"><link rel="prefetch" href="/assets/js/181.e5449166.js"><link rel="prefetch" href="/assets/js/182.903ca4cf.js"><link rel="prefetch" href="/assets/js/183.f2506256.js"><link rel="prefetch" href="/assets/js/184.07b6cfc7.js"><link rel="prefetch" href="/assets/js/185.e92dcf96.js"><link rel="prefetch" href="/assets/js/186.e17f8c1c.js"><link rel="prefetch" href="/assets/js/187.99170016.js"><link rel="prefetch" href="/assets/js/188.90581d2f.js"><link rel="prefetch" href="/assets/js/189.0e1a3abe.js"><link rel="prefetch" href="/assets/js/19.910fc8d0.js"><link rel="prefetch" href="/assets/js/190.41b9ccd3.js"><link rel="prefetch" href="/assets/js/191.4add1d16.js"><link rel="prefetch" href="/assets/js/192.b2cb6399.js"><link rel="prefetch" href="/assets/js/193.b4035cf0.js"><link rel="prefetch" href="/assets/js/194.aca90bf6.js"><link rel="prefetch" href="/assets/js/195.6fa13ccd.js"><link rel="prefetch" href="/assets/js/196.269c7fdd.js"><link rel="prefetch" href="/assets/js/197.9c2db328.js"><link rel="prefetch" href="/assets/js/198.9e158af1.js"><link rel="prefetch" href="/assets/js/199.72ae3d2d.js"><link rel="prefetch" href="/assets/js/20.e8c8408a.js"><link rel="prefetch" href="/assets/js/200.2b7692a5.js"><link rel="prefetch" href="/assets/js/201.47c19701.js"><link rel="prefetch" href="/assets/js/202.c234220d.js"><link rel="prefetch" href="/assets/js/203.238a75d6.js"><link rel="prefetch" href="/assets/js/204.71c0bf86.js"><link rel="prefetch" href="/assets/js/21.287aba19.js"><link rel="prefetch" href="/assets/js/22.f4b7a74b.js"><link rel="prefetch" href="/assets/js/23.fa51555f.js"><link rel="prefetch" href="/assets/js/24.cd8d9d78.js"><link rel="prefetch" href="/assets/js/25.a9fce161.js"><link rel="prefetch" href="/assets/js/26.e3067144.js"><link rel="prefetch" href="/assets/js/27.0610f28c.js"><link rel="prefetch" href="/assets/js/28.f1b496e3.js"><link rel="prefetch" href="/assets/js/29.ef58c202.js"><link rel="prefetch" href="/assets/js/3.970a66a4.js"><link rel="prefetch" href="/assets/js/30.ae297928.js"><link rel="prefetch" href="/assets/js/31.4fd0d93b.js"><link rel="prefetch" href="/assets/js/32.07e772d9.js"><link rel="prefetch" href="/assets/js/33.8045f864.js"><link rel="prefetch" href="/assets/js/34.295422ff.js"><link rel="prefetch" href="/assets/js/35.39e60c42.js"><link rel="prefetch" href="/assets/js/36.fddd48a5.js"><link rel="prefetch" href="/assets/js/37.367a54b5.js"><link rel="prefetch" href="/assets/js/38.a612debc.js"><link rel="prefetch" href="/assets/js/39.94b70e03.js"><link rel="prefetch" href="/assets/js/40.b4ed34c8.js"><link rel="prefetch" href="/assets/js/41.390ffe47.js"><link rel="prefetch" href="/assets/js/42.55e09873.js"><link rel="prefetch" href="/assets/js/43.8065223a.js"><link rel="prefetch" href="/assets/js/44.786fa232.js"><link rel="prefetch" href="/assets/js/45.89a5cd81.js"><link rel="prefetch" href="/assets/js/46.74ac226f.js"><link rel="prefetch" href="/assets/js/47.3bc4cde3.js"><link rel="prefetch" href="/assets/js/48.4ee9fba2.js"><link rel="prefetch" href="/assets/js/49.02a5f0f0.js"><link rel="prefetch" href="/assets/js/5.d1da013e.js"><link rel="prefetch" href="/assets/js/50.5bffa682.js"><link rel="prefetch" href="/assets/js/51.51580cbc.js"><link rel="prefetch" href="/assets/js/52.e69de275.js"><link rel="prefetch" href="/assets/js/53.326a7442.js"><link rel="prefetch" href="/assets/js/54.222addc9.js"><link rel="prefetch" href="/assets/js/55.bd4d5a38.js"><link rel="prefetch" href="/assets/js/56.e14027f4.js"><link rel="prefetch" href="/assets/js/57.949f3da5.js"><link rel="prefetch" href="/assets/js/58.f45aeb0d.js"><link rel="prefetch" href="/assets/js/59.a537c130.js"><link rel="prefetch" href="/assets/js/6.9bdf2d86.js"><link rel="prefetch" href="/assets/js/60.17850c9d.js"><link rel="prefetch" href="/assets/js/61.a9f91faa.js"><link rel="prefetch" href="/assets/js/62.24f5a40d.js"><link rel="prefetch" href="/assets/js/63.60a38d5b.js"><link rel="prefetch" href="/assets/js/64.ecda83e6.js"><link rel="prefetch" href="/assets/js/65.5ac936d7.js"><link rel="prefetch" href="/assets/js/66.ae14e9b3.js"><link rel="prefetch" href="/assets/js/67.6f7c9f8c.js"><link rel="prefetch" href="/assets/js/68.006a7e36.js"><link rel="prefetch" href="/assets/js/69.9d3a3878.js"><link rel="prefetch" href="/assets/js/7.9ac2367b.js"><link rel="prefetch" href="/assets/js/70.4a3f6622.js"><link rel="prefetch" href="/assets/js/71.6d7fab1a.js"><link rel="prefetch" href="/assets/js/72.fab91def.js"><link rel="prefetch" href="/assets/js/73.d791feee.js"><link rel="prefetch" href="/assets/js/74.2801f4e5.js"><link rel="prefetch" href="/assets/js/75.981b86e2.js"><link rel="prefetch" href="/assets/js/76.6241dd05.js"><link rel="prefetch" href="/assets/js/77.da0cc43e.js"><link rel="prefetch" href="/assets/js/78.bf5853c2.js"><link rel="prefetch" href="/assets/js/79.112a39ee.js"><link rel="prefetch" href="/assets/js/8.6b13a443.js"><link rel="prefetch" href="/assets/js/80.f2ed7194.js"><link rel="prefetch" href="/assets/js/81.4b4b8b2f.js"><link rel="prefetch" href="/assets/js/82.65bb49d8.js"><link rel="prefetch" href="/assets/js/83.80cc0629.js"><link rel="prefetch" href="/assets/js/84.f8c4a382.js"><link rel="prefetch" href="/assets/js/85.09c8c91b.js"><link rel="prefetch" href="/assets/js/86.1ff26044.js"><link rel="prefetch" href="/assets/js/87.79d46ddd.js"><link rel="prefetch" href="/assets/js/88.d7051ae9.js"><link rel="prefetch" href="/assets/js/89.ceed231e.js"><link rel="prefetch" href="/assets/js/90.cb5b9f7e.js"><link rel="prefetch" href="/assets/js/91.4c76179c.js"><link rel="prefetch" href="/assets/js/92.f68b9b5c.js"><link rel="prefetch" href="/assets/js/93.f9f451c7.js"><link rel="prefetch" href="/assets/js/94.38528942.js"><link rel="prefetch" href="/assets/js/95.41439023.js"><link rel="prefetch" href="/assets/js/96.bff3c86e.js"><link rel="prefetch" href="/assets/js/97.b6ad2632.js"><link rel="prefetch" href="/assets/js/98.9157217b.js"><link rel="prefetch" href="/assets/js/99.9fedc5bd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1f33e7c2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/author/" class="nav-link">Author</a></div><div class="nav-item"><a href="/articles/" class="nav-link">Blog</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/author/" class="nav-link">Author</a></div><div class="nav-item"><a href="/articles/" class="nav-link">Blog</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>How YOU can use an ORM in .NET Core and C# to type less SQL -starring Entity Framework</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/dotnet-orm.html#resources" class="sidebar-link">Resources</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/dotnet-orm.html#why-orm" class="sidebar-link">Why ORM</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/dotnet-orm.html#the-orm-landscape" class="sidebar-link">The ORM landscape</a></li></ul></li><li><a href="/pages/dotnet-orm.html#what" class="sidebar-link">What</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/dotnet-orm.html#migrations" class="sidebar-link">Migrations</a></li></ul></li><li><a href="/pages/dotnet-orm.html#install-and-set-up" class="sidebar-link">Install and Set up</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/dotnet-orm.html#create-a-solution" class="sidebar-link">Create a solution</a></li><li class="sidebar-sub-header"><a href="/pages/dotnet-orm.html#scaffold-a-console-project" class="sidebar-link">Scaffold a Console project</a></li><li class="sidebar-sub-header"><a href="/pages/dotnet-orm.html#install-and-set-up-2" class="sidebar-link">Install and Set up</a></li></ul></li><li><a href="/pages/dotnet-orm.html#a-crud-demo" class="sidebar-link">A CRUD Demo</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/dotnet-orm.html#create-the-database" class="sidebar-link">Create the database</a></li><li class="sidebar-sub-header"><a href="/pages/dotnet-orm.html#create-a-migration" class="sidebar-link">Create a migration</a></li></ul></li><li><a href="/pages/dotnet-orm.html#read-from-the-database" class="sidebar-link">Read from the database</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/dotnet-orm.html#write-to-the-database" class="sidebar-link">Write to the Database</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/dotnet-orm.html#creating-a-product" class="sidebar-link">Creating a Product</a></li><li class="sidebar-sub-header"><a href="/pages/dotnet-orm.html#create-an-order" class="sidebar-link">Create an Order</a></li><li class="sidebar-sub-header"><a href="/pages/dotnet-orm.html#update" class="sidebar-link">Update</a></li><li class="sidebar-sub-header"><a href="/pages/dotnet-orm.html#deletion" class="sidebar-link">Deletion</a></li></ul></li><li><a href="/pages/dotnet-orm.html#summary" class="sidebar-link">Summary</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="how-you-can-use-an-orm-in-net-core-and-c-to-type-less-sql-starring-entity-framework"><a href="#how-you-can-use-an-orm-in-net-core-and-c-to-type-less-sql-starring-entity-framework" aria-hidden="true" class="header-anchor">#</a> How YOU can use an ORM in .NET Core and C# to type less SQL -starring Entity Framework</h1> <p>Follow me on <a href="https://twitter.com/chris_noring" target="_blank" rel="noopener noreferrer">Twitter<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, happy to take your suggestions on topics or improvements /Chris</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/senihoqu8bizs8oepx82.jpg" alt=""></p> <blockquote><p>We all love SQL right? No? Well sometimes a good SQL query is the best approach but most of the time it's the same CRUD operations that you need to carry out, Create, Read, Update, Delete, on each new entity. With an ORM, an Object Relational Mapper, you are able to define what the structure in your database should look like, using code. Additionally, you can use code for your queries as well. The main ORM for .Net and .Net Core is called Entity Framework and that's what we are covering in this article.</p></blockquote> <p>I just wanted to say a very important thing. A tool like an ORM should NEVER replace learning SQL. An ORM is there to make your life easier so when you end up writing SQL it's for the important things like a reporting query or a query that needs to be really performant. The idea is for the ORM to take care of simpler SQL like creating tables and doing simple inserts. If you use this without a decent knowledge of SQL then please have a look here and try grasp the basics first:</p> <blockquote><p>https://www.w3schools.com/sql/</p></blockquote> <p>TLDR; This article is somewhat lengthy but it starts from the beginning to teach you Entity Framework and covers a lot of really great topics, worth the read.</p> <p>In this article we will cover:</p> <ul><li><strong>WHY an ORM</strong>, we always need to ask ourselves why we use something. ORM can really shine if you have a lot of simple interaction to a database. You can really speed up your operation using it.</li> <li><strong>WHAT</strong> it can help you with.</li> <li><strong>Install</strong> and Set up</li> <li>A CRUD Demo. We will go through reading data, creating, updating and deleting data</li></ul> <h2 id="resources"><a href="#resources" aria-hidden="true" class="header-anchor">#</a> Resources</h2> <ul><li><p><a href="https://docs.microsoft.com/en-us/ef/core/providers/?wt.mc_id=academic-0000-chnoring" target="_blank" rel="noopener noreferrer">Database providers<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
You can work with quite a number of different databases using Entity Framework. The whole idea is to have an agnostic approach so you, in theory, could replace one database for another and your code remains the same. We all know we almost never do that but it's a nice idea.</p></li> <li><p><a href="https://docs.microsoft.com/en-us/ef/core/get-started/netcore/new-db-sqlite?wt.mc_id=academic-0000-chnoring" target="_blank" rel="noopener noreferrer">Beginner EF Core article<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
This article is partly based on this one even if we take it a step further</p></li> <li><p><a href="https://docs.microsoft.com/en-us/aspnet/core/data/ef-mvc/intro?view=aspnetcore-2.2&amp;wt.mc_id=academic-0000-chnoring" target="_blank" rel="noopener noreferrer">Using EF Core in ASP .Net MVC<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://docs.microsoft.com/en-us/ef/core/querying/related-data?wt.mc_id=academic-0000-chnoring" target="_blank" rel="noopener noreferrer">Eager loading<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
We cover the basics of how this works in the article but there is always more to learn.</p></li> <li><p><a href="https://docs.microsoft.com/en-us/ef/core/querying/basic?wt.mc_id=academic-0000-chnoring" target="_blank" rel="noopener noreferrer">Basics of Querying<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://docs.microsoft.com/en-us/ef/core/?wt.mc_id=academic-0000-chnoring" target="_blank" rel="noopener noreferrer">Overview page on everything EF Core<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul> <h2 id="why-orm"><a href="#why-orm" aria-hidden="true" class="header-anchor">#</a> Why ORM</h2> <p>Using an ORM is about beeing faster, more productive and about knowing exactly what goes into a database.</p> <blockquote><p>So when do I use it, always or?</p></blockquote> <p>Well for most simple applications it's definitely good to use. For applications that need really performant queries you can definitely still use it but you need to be more observant on what SQL your ORM produces. Sometimes it's good enough and sometimes you need to write those queries by hand using SQL. Typically reporting queries is something I personally don't use ORMs for as they tend to be complex and hard to express in code. But everyone is different. I've seen even complex queries being authored in code.</p> <h3 id="the-orm-landscape"><a href="#the-orm-landscape" aria-hidden="true" class="header-anchor">#</a> The ORM landscape</h3> <p>There is more than one ORM choice for .Net. Entity Framework is the most known one but there are other ones. You have to decide which one fits your project.</p> <ul><li><p><a href="https://github.com/linq2db/linq2db" target="_blank" rel="noopener noreferrer">Linq 2 db<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
Offers a similar experience to Entity Framework if you look at the syntax alone. Some say the syntax is close to what you get in actual SQL</p></li> <li><p><a href="https://dapper-tutorial.net/" target="_blank" rel="noopener noreferrer">Dapper<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
It has been descriptions like <em>Object Mapper</em> and <em>Micro ORM</em></p></li> <li><p><a href="https://nhibernate.info/" target="_blank" rel="noopener noreferrer">NHibernate<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
.Net port of Hibernate. One of the oldest ORMs out there.</p></li></ul> <p>There are more ORMs out there but the three above are well-known choices.</p> <h2 id="what"><a href="#what" aria-hidden="true" class="header-anchor">#</a> What</h2> <p>Most ORMs lets you define the table structure in code and you can map a class so that it corresponds to a table. The columns are simply properties on the class. Depending on the ORM several approaches are possible</p> <ul><li><strong>Schema first</strong>, in this scenario you define a schema of what tables you have, how they relate like 1-1, 1-Many, Man-to-Many and so on. You end up generating code from the schema.</li> <li><strong>Code first</strong>, In this approach, you define the code first. Every table corresponds to a class and you can express how everything relates in code. Your ORM will then take a look at your code and generate structural SQL from it.</li></ul> <h3 id="migrations"><a href="#migrations" aria-hidden="true" class="header-anchor">#</a> Migrations</h3> <p>A lot of ORMs comes with a concept called <em>migrations</em>. A migration is simply a piece of script that either alters the structure of the database or runs a piece of SQL that affects the data like for example <em>seeding</em> the database with some initial data. The idea is that every time you do a change of the database that should be a small transactional change captured in a migration. That migration can then be <em>applied</em> to the database and thereby the database will be altered in the desired way. For example, adding a Customer table to database would be a migration that when applied would create the table in the Database. A Migration can either be expressed as SQL or in Code.</p> <h2 id="install-and-set-up"><a href="#install-and-set-up" aria-hidden="true" class="header-anchor">#</a> Install and Set up</h2> <p>To get started with Entity Framework we need a couple of NuGet packages but also a project that we can install the NuGet packages to. So for this exercise, we will do the following:</p> <ol><li><strong>Create</strong> a solution</li> <li><strong>Scaffold</strong> a Console project and add a reference to the solution</li> <li><strong>Install</strong> the needed NuGet packages to the Console project</li></ol> <h3 id="create-a-solution"><a href="#create-a-solution" aria-hidden="true" class="header-anchor">#</a> Create a solution</h3> <p>This is quite simply done. First, we need a directory. So create a directory, you can choose the name yourself but here is an example.</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>mkdir demo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Then we need to place ourselves in the directory like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cd demo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="scaffold-a-console-project"><a href="#scaffold-a-console-project" aria-hidden="true" class="header-anchor">#</a> Scaffold a Console project</h3> <p>Next up we need to create our Console project. Again you can choose the name but we go with <code>App</code>. Type the following:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>dotnet new console -o App
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>This will create a new project of type <code>console</code> with name <code>App</code>.</p> <p>Lastly we add this project to the solution like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>dotnet sln add App/App.csproj
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="install-and-set-up-2"><a href="#install-and-set-up-2" aria-hidden="true" class="header-anchor">#</a> Install and Set up</h3> <p>For this we will install the core library for Entity Framework but also support for the database type SqlLite. Note, there is support for different databases, have a look at the full list of supported databases here:</p> <blockquote><p><a href="https://docs.microsoft.com/en-us/ef/core/providers/?wt.mc_id=academic-0000-chnoring" target="_blank" rel="noopener noreferrer">https://docs.microsoft.com/en-us/ef/core/providers/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p>SqlLite is a very simple database that just stores structure and data in a file on your hard drive.</p> <blockquote><p>But I'm working with a real database, what about me, will I benefit from this article?</p></blockquote> <p>Yes, what we are showing is generic knowledge that is widely applicable regardless of database type.</p> <p>Ok then let's first navigate into our Console app directory, like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>cd App
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Then install the needed NuGet libraries:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>dotnet add package Microsoft.EntityFrameworkCore.Sqlite
dotnet add package Microsoft.EntityFrameworkCore.Design
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>This will add references to your project. Open up <code>App.csproj</code> and you should find something like this:</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ItemGroup</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Microsoft.EntityFrameworkCore.Design<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>2.2.6<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PackageReference</span> <span class="token attr-name">Include</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Microsoft.EntityFrameworkCore.Sqlite<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Version</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>2.2.6<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ItemGroup</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Now we need to actually install the libraries, we do that with the following command:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>dotnet restore
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="a-crud-demo"><a href="#a-crud-demo" aria-hidden="true" class="header-anchor">#</a> A CRUD Demo</h2> <p>We will show how to do the full CRUD, Create, Read, Update and Delete.</p> <p>Here we will attempt the following:</p> <ul><li><strong>Create</strong> the database</li> <li><strong>Create a migration</strong> that represents the structure of the database and then apply it to create the database</li> <li><strong>Read</strong> from the database</li> <li><strong>Write</strong> to the database</li> <li><strong>Seed</strong> our database with initial data</li></ul> <h3 id="create-the-database"><a href="#create-the-database" aria-hidden="true" class="header-anchor">#</a> Create the database</h3> <p>First off we need a Database so let's create one.</p> <p>We will create a file called <code>Database.cs</code> with the following content:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// Database.cs</span>

<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>EntityFrameworkCore<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">;</span>
<span class="token keyword">using</span> System<span class="token punctuation">.</span>Collections<span class="token punctuation">.</span>Generic<span class="token punctuation">;</span>

<span class="token keyword">namespace</span> App
<span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DatabaseContext</span> <span class="token punctuation">:</span> <span class="token class-name">DbContext</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> DbSet<span class="token operator">&lt;</span>Product<span class="token operator">&gt;</span> Products <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> DbSet<span class="token operator">&lt;</span>OrderItem<span class="token operator">&gt;</span> OrderItems <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> DbSet<span class="token operator">&lt;</span>Order<span class="token operator">&gt;</span> Orders <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token keyword">void</span> <span class="token function">OnConfiguring</span><span class="token punctuation">(</span><span class="token class-name">DbContextOptionsBuilder</span> optionsBuilder<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      optionsBuilder<span class="token punctuation">.</span><span class="token function">UseSqlite</span><span class="token punctuation">(</span><span class="token string">&quot;Data Source=database.db&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Order</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> OrderId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> DateTime<span class="token punctuation">?</span> Created <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  
    <span class="token keyword">public</span> ICollection<span class="token operator">&lt;</span>OrderItem<span class="token operator">&gt;</span> Items <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderItem</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> OrderItemId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> Quantity <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token class-name">Product</span> Product <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Product</span> 
  <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> ProductId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">double</span> Price <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">string</span> Description <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p>As you can see from the above code we have the following classes:</p> <ul><li><strong>Order</strong>, this is a class representing orders.</li> <li><strong>OrderItem</strong>, an Order has many OrderItems and each OrderItem has a <code>Quantity</code> property and reference to a <code>Product</code></li> <li><strong>Product</strong>, this represents the Product we are trying to order. It has information on it like <code>Price</code> and <code>Description</code>.</li></ul> <p>Let's comment on some interesting constructs in the code.</p> <p><strong>1-Many</strong></p> <p>We are expressing a 1-Many relationship by the following construct on the <code>Order</code> class:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> ICollection<span class="token operator">&lt;</span>OrderItem<span class="token operator">&gt;</span> Items <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Above we are saying that we a list of of OrderItems on the Order.</p> <p><strong>Foreign key</strong></p> <p>We are also expressing another database concept namely <em>Foreign key</em>. In the <code>OrderItem</code> entity we are saying that we have a reference to a Product. In code, we write this as:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token class-name">Product</span> Product <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>DbContext and DbSet</strong></p> <p>Let's also comment on first <code>DbContext</code>. When we want a new Database we should inherit from this class like so:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DatabaseContext</span> <span class="token punctuation">:</span> <span class="token class-name">DbContext</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>DbSet</code> represents a table in a Database. It's a generic that takes a <code>type</code> as a template argument, like so:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">public</span> DbSet<span class="token operator">&lt;</span>OrderItem<span class="token operator">&gt;</span> OrderItems <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="create-a-migration"><a href="#create-a-migration" aria-hidden="true" class="header-anchor">#</a> Create a migration</h3> <p>Now we have saved our file <code>Database.cs</code>. It's time to create the database. To do that we need to do two things:</p> <ul><li><p><strong>Generate a migration</strong>, this takes a snapshot of the current state of your code and diff this to any previous snapshot. If it doesn't have a previous snapshot, generating a migration will simply create the <em>initial migration</em>.</p></li> <li><p><strong>Apply the migration</strong>, this will run the migration. Depending on the content of the migration it will either, create a database, affect the database structure or alter the data.</p></li></ul> <p><strong>Generate a migration</strong></p> <p>Let's create our migration with the following command:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>dotnet ef migrations add InitialCreate
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The last argument is the name of the migration and we can call it what we want but it's good to give it a descriptive name like <code>InitialCreate</code>.</p> <p>Running the command should give the following result in the terminal:</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/pfk5a3yk4h8b0ovdaoh6.png" alt=""></p> <p>As you can see above it's nice enough to tell us how to <em>undo</em> what we just di with the command <code>ef migrations remove</code>.</p> <p>This created some files for us namely the following:</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/rh7ugmlqutp59qu9yr7w.png" alt=""></p> <p>Above you can see that we got our migration <code>InitialCreate</code> but that the name is being prepended by a timestamp. This is so Entity Framework knows what to run and in what order. We can also see that we have two versions of this file, a <em>.cs</em> and a <code>Designer.cs</code> file. We only care about the first one. Let's have a look at it:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> System<span class="token punctuation">;</span>
<span class="token keyword">using</span> Microsoft<span class="token punctuation">.</span>EntityFrameworkCore<span class="token punctuation">.</span>Migrations<span class="token punctuation">;</span>

<span class="token keyword">namespace</span> App<span class="token punctuation">.</span>Migrations
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">InitialCreate</span> <span class="token punctuation">:</span> <span class="token class-name">Migration</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token keyword">void</span> <span class="token function">Up</span><span class="token punctuation">(</span><span class="token class-name">MigrationBuilder</span> migrationBuilder<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            migrationBuilder<span class="token punctuation">.</span><span class="token function">CreateTable</span><span class="token punctuation">(</span>
                name<span class="token punctuation">:</span> <span class="token string">&quot;Orders&quot;</span><span class="token punctuation">,</span>
                columns<span class="token punctuation">:</span> table <span class="token operator">=&gt;</span> <span class="token keyword">new</span>
                <span class="token punctuation">{</span>
                    OrderId <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Column</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>nullable<span class="token punctuation">:</span> <span class="token keyword">false</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">Annotation</span><span class="token punctuation">(</span><span class="token string">&quot;Sqlite:Autoincrement&quot;</span><span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    Created <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Column</span><span class="token punctuation">&lt;</span><span class="token class-name">DateTime</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>nullable<span class="token punctuation">:</span> <span class="token keyword">true</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                constraints<span class="token punctuation">:</span> table <span class="token operator">=&gt;</span>
                <span class="token punctuation">{</span>
                    table<span class="token punctuation">.</span><span class="token function">PrimaryKey</span><span class="token punctuation">(</span><span class="token string">&quot;PK_Orders&quot;</span><span class="token punctuation">,</span> x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>OrderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            migrationBuilder<span class="token punctuation">.</span><span class="token function">CreateTable</span><span class="token punctuation">(</span>
                name<span class="token punctuation">:</span> <span class="token string">&quot;Products&quot;</span><span class="token punctuation">,</span>
                columns<span class="token punctuation">:</span> table <span class="token operator">=&gt;</span> <span class="token keyword">new</span>
                <span class="token punctuation">{</span>
                    ProductId <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Column</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>nullable<span class="token punctuation">:</span> <span class="token keyword">false</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">Annotation</span><span class="token punctuation">(</span><span class="token string">&quot;Sqlite:Autoincrement&quot;</span><span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    Price <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Column</span><span class="token punctuation">&lt;</span><span class="token keyword">double</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>nullable<span class="token punctuation">:</span> <span class="token keyword">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    Description <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Column</span><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>nullable<span class="token punctuation">:</span> <span class="token keyword">true</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                constraints<span class="token punctuation">:</span> table <span class="token operator">=&gt;</span>
                <span class="token punctuation">{</span>
                    table<span class="token punctuation">.</span><span class="token function">PrimaryKey</span><span class="token punctuation">(</span><span class="token string">&quot;PK_Products&quot;</span><span class="token punctuation">,</span> x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>ProductId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            migrationBuilder<span class="token punctuation">.</span><span class="token function">CreateTable</span><span class="token punctuation">(</span>
                name<span class="token punctuation">:</span> <span class="token string">&quot;OrderItems&quot;</span><span class="token punctuation">,</span>
                columns<span class="token punctuation">:</span> table <span class="token operator">=&gt;</span> <span class="token keyword">new</span>
                <span class="token punctuation">{</span>
                    OrderItemId <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Column</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>nullable<span class="token punctuation">:</span> <span class="token keyword">false</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">Annotation</span><span class="token punctuation">(</span><span class="token string">&quot;Sqlite:Autoincrement&quot;</span><span class="token punctuation">,</span> <span class="token keyword">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    Quantity <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Column</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>nullable<span class="token punctuation">:</span> <span class="token keyword">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    ProductId <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Column</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>nullable<span class="token punctuation">:</span> <span class="token keyword">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    OrderId <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Column</span><span class="token punctuation">&lt;</span><span class="token keyword">int</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>nullable<span class="token punctuation">:</span> <span class="token keyword">true</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                constraints<span class="token punctuation">:</span> table <span class="token operator">=&gt;</span>
                <span class="token punctuation">{</span>
                    table<span class="token punctuation">.</span><span class="token function">PrimaryKey</span><span class="token punctuation">(</span><span class="token string">&quot;PK_OrderItems&quot;</span><span class="token punctuation">,</span> x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>OrderItemId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    table<span class="token punctuation">.</span><span class="token function">ForeignKey</span><span class="token punctuation">(</span>
                        name<span class="token punctuation">:</span> <span class="token string">&quot;FK_OrderItems_Orders_OrderId&quot;</span><span class="token punctuation">,</span>
                        column<span class="token punctuation">:</span> x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>OrderId<span class="token punctuation">,</span>
                        principalTable<span class="token punctuation">:</span> <span class="token string">&quot;Orders&quot;</span><span class="token punctuation">,</span>
                        principalColumn<span class="token punctuation">:</span> <span class="token string">&quot;OrderId&quot;</span><span class="token punctuation">,</span>
                        onDelete<span class="token punctuation">:</span> ReferentialAction<span class="token punctuation">.</span>Restrict<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    table<span class="token punctuation">.</span><span class="token function">ForeignKey</span><span class="token punctuation">(</span>
                        name<span class="token punctuation">:</span> <span class="token string">&quot;FK_OrderItems_Products_ProductId&quot;</span><span class="token punctuation">,</span>
                        column<span class="token punctuation">:</span> x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>ProductId<span class="token punctuation">,</span>
                        principalTable<span class="token punctuation">:</span> <span class="token string">&quot;Products&quot;</span><span class="token punctuation">,</span>
                        principalColumn<span class="token punctuation">:</span> <span class="token string">&quot;ProductId&quot;</span><span class="token punctuation">,</span>
                        onDelete<span class="token punctuation">:</span> ReferentialAction<span class="token punctuation">.</span>Restrict<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            migrationBuilder<span class="token punctuation">.</span><span class="token function">CreateIndex</span><span class="token punctuation">(</span>
                name<span class="token punctuation">:</span> <span class="token string">&quot;IX_OrderItems_OrderId&quot;</span><span class="token punctuation">,</span>
                table<span class="token punctuation">:</span> <span class="token string">&quot;OrderItems&quot;</span><span class="token punctuation">,</span>
                column<span class="token punctuation">:</span> <span class="token string">&quot;OrderId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            migrationBuilder<span class="token punctuation">.</span><span class="token function">CreateIndex</span><span class="token punctuation">(</span>
                name<span class="token punctuation">:</span> <span class="token string">&quot;IX_OrderItems_ProductId&quot;</span><span class="token punctuation">,</span>
                table<span class="token punctuation">:</span> <span class="token string">&quot;OrderItems&quot;</span><span class="token punctuation">,</span>
                column<span class="token punctuation">:</span> <span class="token string">&quot;ProductId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token keyword">void</span> <span class="token function">Down</span><span class="token punctuation">(</span><span class="token class-name">MigrationBuilder</span> migrationBuilder<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            migrationBuilder<span class="token punctuation">.</span><span class="token function">DropTable</span><span class="token punctuation">(</span>
                name<span class="token punctuation">:</span> <span class="token string">&quot;OrderItems&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            migrationBuilder<span class="token punctuation">.</span><span class="token function">DropTable</span><span class="token punctuation">(</span>
                name<span class="token punctuation">:</span> <span class="token string">&quot;Orders&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            migrationBuilder<span class="token punctuation">.</span><span class="token function">DropTable</span><span class="token punctuation">(</span>
                name<span class="token punctuation">:</span> <span class="token string">&quot;Products&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br></div></div><p>The first thing we see is that we inherit from the class <code>Migration</code>. The second thing is that we have two methods <code>Up()</code> and <code>Down()</code>. <code>Up()</code> is run when we want to apply something. <code>Down()</code> is run when we want to <em>undo</em> the migration. Looking at our <code>Up()</code> method we can see that we invoke <code>CreateTable()</code> once for each of the tables <code>Order</code>, <code>OrderItem</code> and <code>Product</code>. We can also see that it defines all the Foreign keys needed. The <code>Down()</code> method calls <code>DropTable()</code> to <em>undo</em> our table creation.</p> <p><strong>Apply the Migration</strong></p> <p>Ok, we have a Migration, let's <em>apply</em> it. We do that with the following command:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>dotnet ef database update
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>This will first create the database if needed and then apply the migration.</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/topziid6t8af3o4bwwci.png" alt=""></p> <p>We can see in our file structure that we got a new file created <code>database.db</code>. We can either use a SQlLite client or why not write some code to connect to it ? 😃</p> <h2 id="read-from-the-database"><a href="#read-from-the-database" aria-hidden="true" class="header-anchor">#</a> Read from the database</h2> <p>Ok, now we want to see if we can connect to our database and maybe read out out some data. Open up <code>Program.cs</code> and go to the method <code>Main()</code> and add the following:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatabaseContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>This will establish a connection to our database. To read from the database we only need to read from it like this:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatabaseContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">var</span> orders <span class="token operator">=</span> db<span class="token punctuation">.</span>Orders<span class="token punctuation">;</span>
  <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token keyword">var</span> order <span class="token keyword">in</span> orders<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Order: order.Created&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Shall we try it out?</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/pe8gwgvdq3myct922qhi.png" alt=""></p> <p>Ok, we got no orders 😦.</p> <p>Well, this is expected, we didn't put anything in the database. How bout we change that?</p> <h2 id="write-to-the-database"><a href="#write-to-the-database" aria-hidden="true" class="header-anchor">#</a> Write to the Database</h2> <p>Ok, we know how to connect to the Database. What about writing to it?</p> <p>Well to be able to create an <code>Order</code>, we need a little data first in the form of at least one <code>Product</code> and one <code>OrderItem</code>. If you want to save something to the database you need to call <code>db.SaveChanges()</code>.</p> <p>We need to take all of this in steps cause there are some moving parts.</p> <h3 id="creating-a-product"><a href="#creating-a-product" aria-hidden="true" class="header-anchor">#</a> Creating a Product</h3> <p>First, we will create a <code>Product</code>.</p> <p>Let's add the following code:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatabaseContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    
    <span class="token keyword">var</span> product <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Product</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> Price <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> Description <span class="token operator">=</span> <span class="token string">&quot;Movie&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    db<span class="token punctuation">.</span>Products<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
    db<span class="token punctuation">.</span><span class="token function">SaveChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token keyword">var</span> p <span class="token keyword">in</span> db<span class="token punctuation">.</span>Products<span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0} {1} {2}&quot;</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>ProductId<span class="token punctuation">,</span> p<span class="token punctuation">.</span>Description<span class="token punctuation">,</span> p<span class="token punctuation">.</span>Price<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>The above will create our <code>Product</code> and by invoking <code>db.SaveChanges()</code> we make sure to persist it to the database.</p> <p>Running the code leads to</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/3mmuogs3rswgof67f0my.png" alt=""></p> <p><strong>OrderItem</strong></p> <p>Ok, that bit works. What about creating an <code>OrderItem</code>? Well that's just as easy, we just need the following code:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatabaseContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> product <span class="token operator">=</span> db<span class="token punctuation">.</span>Products<span class="token punctuation">.</span><span class="token function">SingleOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span><span class="token punctuation">(</span>product <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">var</span> item <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderItem</span>
        <span class="token punctuation">{</span>
            Quantity <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
            Product <span class="token operator">=</span> product
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        db<span class="token punctuation">.</span>OrderItems<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
        db<span class="token punctuation">.</span><span class="token function">SaveChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;{0} {1} Product: {2}&quot;</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span>OrderItemId<span class="token punctuation">,</span> item<span class="token punctuation">.</span>Quantity<span class="token punctuation">,</span> item<span class="token punctuation">.</span>Product<span class="token punctuation">.</span>Description<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>Let's try to highlight the important parts.</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/h1rn0g903qcu5k0h9gyw.png" alt=""></p> <p>Above we can see that we first read out a <code>product</code> from the database. The next thing we do is to assign that same product to the <code>Product</code> property on the <code>OrderItem</code>. Then we save it all by adding our <code>OrderItem</code> to <code>db.OrderItems</code> followed by calling <code>db.SaveChanges()</code>.</p> <h3 id="create-an-order"><a href="#create-an-order" aria-hidden="true" class="header-anchor">#</a> Create an Order</h3> <p>By now we have a <code>Product</code> and an <code>OrderItem</code> in the database. So how do we go about creating an Order containing those two entities?</p> <p>Well creating an Order is not just creating an Order, it's creating an Order AND associate the OrderItem with the Order.</p> <p>The association part can be done in two different ways:</p> <ol><li>Add the OrderItem to <code>order.Items</code></li> <li>Add a foreign key to our OrderItem and assign our Order id.</li></ol> <p>Both of the above solutions require us to know a bit more about Entity Framework.</p> <p><strong>Load related entities</strong></p> <p>Let's start with the first approach. For that, we need to know how to load related entities.</p> <blockquote><p>Why?</p></blockquote> <p>Well, when you have an <code>Order</code> instance its <code>Items</code> will be <code>null</code> unless we tell it explicitly to be filled with something. For this approach to work, we need it to be an empty list at least so we can add our <code>OrderItem</code>.</p> <blockquote><p>Ok, think you better show me.</p></blockquote> <p>Sure, have a look at the following code below:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">var</span> item <span class="token operator">=</span> db<span class="token punctuation">.</span>OrderItems<span class="token punctuation">.</span><span class="token function">SingleOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> order <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Order</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> Created <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now <span class="token punctuation">}</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span>Orders<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">SaveChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>This creates an Order. What about adding our <code>item</code>? Well, we have a problem:</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/6k8fschsk4sx9ru1ff1f.png" alt=""></p> <p>Were we to attempt to our <code>item</code> at after we save our <code>Order</code> at row 49 our <code>order.Items</code> would be <code>null</code> and we would get a runtime exception. To solve that we need to use the method <code>Include()</code>. <code>Include()</code> takes a lambda where we need to point out what we want to load. In this case, we want to load the property <code>Items</code> on our <code>Order</code>.</p> <p>Let's run this code:</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/43h25e3kb6t2e4r5zzue.png" alt=""></p> <p>At this point our <code>order.Items</code> is an empty array and we can add our <code>OrderItem</code> without the code crashing as you can see because we make it to line 54.</p> <p><strong>Add a foreign key to OrderItem</strong></p> <p>Behind the scenes, we have already gotten a foreign key on <code>OrderItem</code>. We can see that if we open up our migration:</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/izsvemi4ucxibcxdoljc.png" alt=""></p> <p>Our problem right now is that it doesn't exist as a property on our <code>OrderItem</code>, so how do we solve that?</p> <p>Well, we just added to the class definition:</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/c4txnmgwgrjqit0mq4p9.png" alt=""></p> <p>Then because we have an existing Order that's associated with an OrderItem the following is actually populated <code>item.OrderId</code>:</p> <p><img src="https://thepracticaldev.s3.amazonaws.com/i/2rb3kx9lm8sg5a6j0r3o.png" alt=""></p> <p>Had we wanted to make the connection between the Order and the OrderItem, and there already wasn't one, we could easily have done so with the following code:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span><span class="token punctuation">(</span><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatabaseContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
  <span class="token keyword">var</span> order <span class="token operator">=</span> db<span class="token punctuation">.</span>Orders<span class="token punctuation">.</span><span class="token function">SingleOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> item <span class="token operator">=</span> db<span class="token punctuation">.</span>OrderItems<span class="token punctuation">.</span><span class="token function">SingleOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  item<span class="token punctuation">.</span>OrderId <span class="token operator">=</span> order<span class="token punctuation">.</span>OrderId<span class="token punctuation">;</span>
  db<span class="token punctuation">.</span><span class="token function">SaveChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="update"><a href="#update" aria-hidden="true" class="header-anchor">#</a> Update</h3> <p>Updating is as easy as following the second creating scenario we did for an Order. That is read up an entity, set a property and call <code>db.SaveChanges()</code>. Like so:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span><span class="token punctuation">(</span><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatabaseContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
  <span class="token keyword">var</span> item <span class="token operator">=</span> db<span class="token punctuation">.</span>OrderItems<span class="token punctuation">.</span><span class="token function">SingleOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  item<span class="token punctuation">.</span>Quantity<span class="token operator">++</span><span class="token punctuation">;</span>
  db<span class="token punctuation">.</span><span class="token function">SaveChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="deletion"><a href="#deletion" aria-hidden="true" class="header-anchor">#</a> Deletion</h3> <p>Deleting is as easy as removing something from a list. If we want to delete a <code>Product</code> we just need to do the following:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span><span class="token punctuation">(</span><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatabaseContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
  <span class="token keyword">var</span> product <span class="token operator">=</span> db<span class="token punctuation">.</span>Products<span class="token punctuation">.</span><span class="token function">SingleOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db<span class="token punctuation">.</span>Products<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
  db<span class="token punctuation">.</span><span class="token function">SaveChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>It should be noted that if your Product is part of an <code>OrderItem</code> you would need to remove that connection first like so:</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token keyword">using</span><span class="token punctuation">(</span><span class="token keyword">var</span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DatabaseContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
  
  <span class="token keyword">var</span> item <span class="token operator">=</span> db<span class="token punctuation">.</span>OrderItems<span class="token punctuation">.</span><span class="token function">Include</span><span class="token punctuation">(</span>i <span class="token operator">=&gt;</span> i<span class="token punctuation">.</span>Product<span class="token punctuation">)</span><span class="token function">SingleOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  item<span class="token punctuation">.</span>Product <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  db<span class="token punctuation">.</span><span class="token function">SaveChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> product <span class="token operator">=</span> db<span class="token punctuation">.</span>Products<span class="token punctuation">.</span><span class="token function">SingleOrDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db<span class="token punctuation">.</span>Products<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">;</span>
  db<span class="token punctuation">.</span><span class="token function">SaveChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="summary"><a href="#summary" aria-hidden="true" class="header-anchor">#</a> Summary</h2> <p>This where we stop. We learned a ton in this article if we started from absolute zero</p> <p>We learned:</p> <ul><li>What an ORM is</li> <li>Define our database structure</li> <li>Create a migration and apply it</li> <li>Read data</li> <li>Create data</li> <li>Update data</li> <li>Delete data</li> <li>Load related entities</li> <li>Foreign keys</li></ul> <p>That's a lot for one article. Hopefully, you are now so interested that you want to learn more. Have a look at the Resources section to learn more if you want to learn more advanced concepts and about dealing with different kinds of databases.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.95c997f3.js" defer></script><script src="/assets/js/9.454b5262.js" defer></script><script src="/assets/js/4.eac68367.js" defer></script><script src="/assets/js/156.8d837db5.js" defer></script>
  </body>
</html>
