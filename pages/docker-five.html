<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Learn Docker, from the beginning, part V</title>
    <meta name="description" content="[object Object]">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    
    <link rel="preload" href="/assets/css/0.styles.1f33e7c2.css" as="style"><link rel="preload" href="/assets/js/app.95c997f3.js" as="script"><link rel="preload" href="/assets/js/9.454b5262.js" as="script"><link rel="preload" href="/assets/js/4.eac68367.js" as="script"><link rel="preload" href="/assets/js/136.5f5c962b.js" as="script"><link rel="prefetch" href="/assets/js/1.36663999.js"><link rel="prefetch" href="/assets/js/10.6aaebcfe.js"><link rel="prefetch" href="/assets/js/100.f7776fae.js"><link rel="prefetch" href="/assets/js/101.83c4ff25.js"><link rel="prefetch" href="/assets/js/102.d3a51c53.js"><link rel="prefetch" href="/assets/js/103.005176e9.js"><link rel="prefetch" href="/assets/js/104.ad6ac0a2.js"><link rel="prefetch" href="/assets/js/105.1c2918c1.js"><link rel="prefetch" href="/assets/js/106.84577e76.js"><link rel="prefetch" href="/assets/js/107.39206cda.js"><link rel="prefetch" href="/assets/js/108.b717e412.js"><link rel="prefetch" href="/assets/js/109.a0275c41.js"><link rel="prefetch" href="/assets/js/11.e44a9c79.js"><link rel="prefetch" href="/assets/js/110.acd428a7.js"><link rel="prefetch" href="/assets/js/111.85c1f355.js"><link rel="prefetch" href="/assets/js/112.62bab5e5.js"><link rel="prefetch" href="/assets/js/113.30083b82.js"><link rel="prefetch" href="/assets/js/114.2dcc568f.js"><link rel="prefetch" href="/assets/js/115.2ee55351.js"><link rel="prefetch" href="/assets/js/116.44cdb765.js"><link rel="prefetch" href="/assets/js/117.f22ffed2.js"><link rel="prefetch" href="/assets/js/118.fda8edf7.js"><link rel="prefetch" href="/assets/js/119.1ea9eae7.js"><link rel="prefetch" href="/assets/js/12.02e6e552.js"><link rel="prefetch" href="/assets/js/120.cf073939.js"><link rel="prefetch" href="/assets/js/121.d06bb8bc.js"><link rel="prefetch" href="/assets/js/122.533a0953.js"><link rel="prefetch" href="/assets/js/123.382bf140.js"><link rel="prefetch" href="/assets/js/124.1e416617.js"><link rel="prefetch" href="/assets/js/125.88e1d9ef.js"><link rel="prefetch" href="/assets/js/126.ac7f0ed9.js"><link rel="prefetch" href="/assets/js/127.2452b31c.js"><link rel="prefetch" href="/assets/js/128.4387dd5e.js"><link rel="prefetch" href="/assets/js/129.57ea763a.js"><link rel="prefetch" href="/assets/js/13.215ad842.js"><link rel="prefetch" href="/assets/js/130.db7a97a9.js"><link rel="prefetch" href="/assets/js/131.cb028185.js"><link rel="prefetch" href="/assets/js/132.1f53aba9.js"><link rel="prefetch" href="/assets/js/133.3e4f88da.js"><link rel="prefetch" href="/assets/js/134.78b60412.js"><link rel="prefetch" href="/assets/js/135.67d56f81.js"><link rel="prefetch" href="/assets/js/137.a4bdc628.js"><link rel="prefetch" href="/assets/js/138.9e4dca1e.js"><link rel="prefetch" href="/assets/js/139.ff87d106.js"><link rel="prefetch" href="/assets/js/14.12340cee.js"><link rel="prefetch" href="/assets/js/140.345c5f56.js"><link rel="prefetch" href="/assets/js/141.7ca86301.js"><link rel="prefetch" href="/assets/js/142.dd05b794.js"><link rel="prefetch" href="/assets/js/143.c0950d2f.js"><link rel="prefetch" href="/assets/js/144.e36983d5.js"><link rel="prefetch" href="/assets/js/145.0fe3cd59.js"><link rel="prefetch" href="/assets/js/146.cabf0d13.js"><link rel="prefetch" href="/assets/js/147.41e37bae.js"><link rel="prefetch" href="/assets/js/148.1aff1942.js"><link rel="prefetch" href="/assets/js/149.43ddd51d.js"><link rel="prefetch" href="/assets/js/15.34674cd6.js"><link rel="prefetch" href="/assets/js/150.2dcc7e56.js"><link rel="prefetch" href="/assets/js/151.8267fcff.js"><link rel="prefetch" href="/assets/js/152.19aac962.js"><link rel="prefetch" href="/assets/js/153.90c26683.js"><link rel="prefetch" href="/assets/js/154.11f5eee4.js"><link rel="prefetch" href="/assets/js/155.fcfefbc5.js"><link rel="prefetch" href="/assets/js/156.8d837db5.js"><link rel="prefetch" href="/assets/js/157.347109ba.js"><link rel="prefetch" href="/assets/js/158.ad5d15c7.js"><link rel="prefetch" href="/assets/js/159.fa03b2bf.js"><link rel="prefetch" href="/assets/js/16.119e91d4.js"><link rel="prefetch" href="/assets/js/160.77c40a45.js"><link rel="prefetch" href="/assets/js/161.bc50d184.js"><link rel="prefetch" href="/assets/js/162.6eb99077.js"><link rel="prefetch" href="/assets/js/163.7daf038b.js"><link rel="prefetch" href="/assets/js/164.29a5a4a0.js"><link rel="prefetch" href="/assets/js/165.2158f290.js"><link rel="prefetch" href="/assets/js/166.7edeee8d.js"><link rel="prefetch" href="/assets/js/167.7fba076e.js"><link rel="prefetch" href="/assets/js/168.aee92853.js"><link rel="prefetch" href="/assets/js/169.f1c69f9e.js"><link rel="prefetch" href="/assets/js/17.780050f1.js"><link rel="prefetch" href="/assets/js/170.c3db9ca3.js"><link rel="prefetch" href="/assets/js/171.39f16573.js"><link rel="prefetch" href="/assets/js/172.854c26f8.js"><link rel="prefetch" href="/assets/js/173.7ac7eb22.js"><link rel="prefetch" href="/assets/js/174.8b371e6b.js"><link rel="prefetch" href="/assets/js/175.2ea22ad4.js"><link rel="prefetch" href="/assets/js/176.342164c7.js"><link rel="prefetch" href="/assets/js/177.ca5f8796.js"><link rel="prefetch" href="/assets/js/178.b191bdb8.js"><link rel="prefetch" href="/assets/js/179.976e6278.js"><link rel="prefetch" href="/assets/js/18.053933da.js"><link rel="prefetch" href="/assets/js/180.aedfb4ca.js"><link rel="prefetch" href="/assets/js/181.e5449166.js"><link rel="prefetch" href="/assets/js/182.903ca4cf.js"><link rel="prefetch" href="/assets/js/183.f2506256.js"><link rel="prefetch" href="/assets/js/184.07b6cfc7.js"><link rel="prefetch" href="/assets/js/185.e92dcf96.js"><link rel="prefetch" href="/assets/js/186.e17f8c1c.js"><link rel="prefetch" href="/assets/js/187.99170016.js"><link rel="prefetch" href="/assets/js/188.90581d2f.js"><link rel="prefetch" href="/assets/js/189.0e1a3abe.js"><link rel="prefetch" href="/assets/js/19.910fc8d0.js"><link rel="prefetch" href="/assets/js/190.41b9ccd3.js"><link rel="prefetch" href="/assets/js/191.4add1d16.js"><link rel="prefetch" href="/assets/js/192.b2cb6399.js"><link rel="prefetch" href="/assets/js/193.b4035cf0.js"><link rel="prefetch" href="/assets/js/194.aca90bf6.js"><link rel="prefetch" href="/assets/js/195.6fa13ccd.js"><link rel="prefetch" href="/assets/js/196.269c7fdd.js"><link rel="prefetch" href="/assets/js/197.9c2db328.js"><link rel="prefetch" href="/assets/js/198.9e158af1.js"><link rel="prefetch" href="/assets/js/199.72ae3d2d.js"><link rel="prefetch" href="/assets/js/20.e8c8408a.js"><link rel="prefetch" href="/assets/js/200.2b7692a5.js"><link rel="prefetch" href="/assets/js/201.47c19701.js"><link rel="prefetch" href="/assets/js/202.c234220d.js"><link rel="prefetch" href="/assets/js/203.238a75d6.js"><link rel="prefetch" href="/assets/js/204.71c0bf86.js"><link rel="prefetch" href="/assets/js/21.287aba19.js"><link rel="prefetch" href="/assets/js/22.f4b7a74b.js"><link rel="prefetch" href="/assets/js/23.fa51555f.js"><link rel="prefetch" href="/assets/js/24.cd8d9d78.js"><link rel="prefetch" href="/assets/js/25.a9fce161.js"><link rel="prefetch" href="/assets/js/26.e3067144.js"><link rel="prefetch" href="/assets/js/27.0610f28c.js"><link rel="prefetch" href="/assets/js/28.f1b496e3.js"><link rel="prefetch" href="/assets/js/29.ef58c202.js"><link rel="prefetch" href="/assets/js/3.970a66a4.js"><link rel="prefetch" href="/assets/js/30.ae297928.js"><link rel="prefetch" href="/assets/js/31.4fd0d93b.js"><link rel="prefetch" href="/assets/js/32.07e772d9.js"><link rel="prefetch" href="/assets/js/33.8045f864.js"><link rel="prefetch" href="/assets/js/34.295422ff.js"><link rel="prefetch" href="/assets/js/35.39e60c42.js"><link rel="prefetch" href="/assets/js/36.fddd48a5.js"><link rel="prefetch" href="/assets/js/37.367a54b5.js"><link rel="prefetch" href="/assets/js/38.a612debc.js"><link rel="prefetch" href="/assets/js/39.94b70e03.js"><link rel="prefetch" href="/assets/js/40.b4ed34c8.js"><link rel="prefetch" href="/assets/js/41.390ffe47.js"><link rel="prefetch" href="/assets/js/42.55e09873.js"><link rel="prefetch" href="/assets/js/43.8065223a.js"><link rel="prefetch" href="/assets/js/44.786fa232.js"><link rel="prefetch" href="/assets/js/45.89a5cd81.js"><link rel="prefetch" href="/assets/js/46.74ac226f.js"><link rel="prefetch" href="/assets/js/47.3bc4cde3.js"><link rel="prefetch" href="/assets/js/48.4ee9fba2.js"><link rel="prefetch" href="/assets/js/49.02a5f0f0.js"><link rel="prefetch" href="/assets/js/5.d1da013e.js"><link rel="prefetch" href="/assets/js/50.5bffa682.js"><link rel="prefetch" href="/assets/js/51.51580cbc.js"><link rel="prefetch" href="/assets/js/52.e69de275.js"><link rel="prefetch" href="/assets/js/53.326a7442.js"><link rel="prefetch" href="/assets/js/54.222addc9.js"><link rel="prefetch" href="/assets/js/55.bd4d5a38.js"><link rel="prefetch" href="/assets/js/56.e14027f4.js"><link rel="prefetch" href="/assets/js/57.949f3da5.js"><link rel="prefetch" href="/assets/js/58.f45aeb0d.js"><link rel="prefetch" href="/assets/js/59.a537c130.js"><link rel="prefetch" href="/assets/js/6.9bdf2d86.js"><link rel="prefetch" href="/assets/js/60.17850c9d.js"><link rel="prefetch" href="/assets/js/61.a9f91faa.js"><link rel="prefetch" href="/assets/js/62.24f5a40d.js"><link rel="prefetch" href="/assets/js/63.60a38d5b.js"><link rel="prefetch" href="/assets/js/64.ecda83e6.js"><link rel="prefetch" href="/assets/js/65.5ac936d7.js"><link rel="prefetch" href="/assets/js/66.ae14e9b3.js"><link rel="prefetch" href="/assets/js/67.6f7c9f8c.js"><link rel="prefetch" href="/assets/js/68.006a7e36.js"><link rel="prefetch" href="/assets/js/69.9d3a3878.js"><link rel="prefetch" href="/assets/js/7.9ac2367b.js"><link rel="prefetch" href="/assets/js/70.4a3f6622.js"><link rel="prefetch" href="/assets/js/71.6d7fab1a.js"><link rel="prefetch" href="/assets/js/72.fab91def.js"><link rel="prefetch" href="/assets/js/73.d791feee.js"><link rel="prefetch" href="/assets/js/74.2801f4e5.js"><link rel="prefetch" href="/assets/js/75.981b86e2.js"><link rel="prefetch" href="/assets/js/76.6241dd05.js"><link rel="prefetch" href="/assets/js/77.da0cc43e.js"><link rel="prefetch" href="/assets/js/78.bf5853c2.js"><link rel="prefetch" href="/assets/js/79.112a39ee.js"><link rel="prefetch" href="/assets/js/8.6b13a443.js"><link rel="prefetch" href="/assets/js/80.f2ed7194.js"><link rel="prefetch" href="/assets/js/81.4b4b8b2f.js"><link rel="prefetch" href="/assets/js/82.65bb49d8.js"><link rel="prefetch" href="/assets/js/83.80cc0629.js"><link rel="prefetch" href="/assets/js/84.f8c4a382.js"><link rel="prefetch" href="/assets/js/85.09c8c91b.js"><link rel="prefetch" href="/assets/js/86.1ff26044.js"><link rel="prefetch" href="/assets/js/87.79d46ddd.js"><link rel="prefetch" href="/assets/js/88.d7051ae9.js"><link rel="prefetch" href="/assets/js/89.ceed231e.js"><link rel="prefetch" href="/assets/js/90.cb5b9f7e.js"><link rel="prefetch" href="/assets/js/91.4c76179c.js"><link rel="prefetch" href="/assets/js/92.f68b9b5c.js"><link rel="prefetch" href="/assets/js/93.f9f451c7.js"><link rel="prefetch" href="/assets/js/94.38528942.js"><link rel="prefetch" href="/assets/js/95.41439023.js"><link rel="prefetch" href="/assets/js/96.bff3c86e.js"><link rel="prefetch" href="/assets/js/97.b6ad2632.js"><link rel="prefetch" href="/assets/js/98.9157217b.js"><link rel="prefetch" href="/assets/js/99.9fedc5bd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1f33e7c2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/author/" class="nav-link">Author</a></div><div class="nav-item"><a href="/articles/" class="nav-link">Blog</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/author/" class="nav-link">Author</a></div><div class="nav-item"><a href="/articles/" class="nav-link">Blog</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Learn Docker, from the beginning, part V</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/docker-five.html#resources" class="sidebar-link">Resources</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/docker-five.html#environment-variables" class="sidebar-link">Environment variables</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/docker-five.html#volumes" class="sidebar-link">Volumes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/docker-five.html#create-a-persistent-space" class="sidebar-link">Create a persistent space</a></li><li class="sidebar-sub-header"><a href="/pages/docker-five.html#adding-a-database" class="sidebar-link">Adding a database</a></li><li class="sidebar-sub-header"><a href="/pages/docker-five.html#connecting-to-the-database" class="sidebar-link">Connecting to the database</a></li><li class="sidebar-sub-header"><a href="/pages/docker-five.html#setting-up-the-database-—-fill-it-with-structure-and-data" class="sidebar-link">Setting up the database — fill it with structure and data</a></li></ul></li><li><a href="/pages/docker-five.html#summary" class="sidebar-link">Summary</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="learn-docker-from-the-beginning-part-v"><a href="#learn-docker-from-the-beginning-part-v" aria-hidden="true" class="header-anchor">#</a> Learn Docker, from the beginning, part V</h1> <p><img src="https://cdn-images-1.medium.com/max/800/1*Vju_axcWsgxsBCRf3527Dw.jpeg" alt=""></p> <p>Follow me on <a href="https://twitter.com/chris_noring" target="_blank" rel="noopener noreferrer">Twitter<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, happy to take your suggestions on topics or improvements /Chris</p> <p>This article is part of a series:</p> <ul><li><p><a href="https://dev.to/softchris/docker---from-the-beginning-part-i-28c6https://dev.to/softchris/docker---from-the-beginning-part-i-28c6" target="_blank" rel="noopener noreferrer">Docker — from the beginning part I<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, this covers why Docker, the basic concepts and the commands we need to manage things like images and containers.</p></li> <li><p><a href="https://dev.to/softchris/docker-from-the-beginning---part-ii-5g8n" target="_blank" rel="noopener noreferrer">Docker — from the beginning, Part II<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, this is about Volumes and how we can use volumes to persist data but also how we can turn our development environment into a Volume and make our development experience considerably better</p></li> <li><p><a href="https://softchris.github.io/pages/docker-three.html" target="_blank" rel="noopener noreferrer">Docker — from the beginning, Part III<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>,
this is about how to deal with Databases, putting them into containers and how to make containers talk to other containers using legacy linking but also the new standard through networks</p></li> <li><p><a href="https://softchris.github.io/pages/docker-four.html" target="_blank" rel="noopener noreferrer">Docker — from the beginning, Part IV<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, Part IV, this is how we manage more than one service using Docker Compose ( this is 1/2 part on Docker Compose)</p></li> <li><p>Docker - from the beginning, Part V, <strong>we are here</strong></p></li></ul> <p>We will keep working on our project introduced in Part IV and in doing so we will showcase more Docker Compose features and essentially build out our project to cover everything you might possibly need.</p> <p>In this part, we will cover:</p> <ul><li><strong>Environment variables</strong> , now we have covered those in previous parts so this is mostly about how we set them in Docker Compose</li> <li><strong>Volumes</strong> , same thing with volumes, this has been covered in previous articles even though we will mention their use and how to work with them with Docker Compose</li> <li><strong>Networks and Databases</strong> , finally we will cover Databases and Networks, this part is a bit tricky but hopefully, we managed to explain it thoroughly</li></ul> <p>If you at any point should feel confused here is the repo this article is based on:</p> <blockquote><p><a href="https://github.com/softchris/docker-compose-experiments" target="_blank" rel="noopener noreferrer">https://github.com/softchris/docker-compose-experiments<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h2 id="resources"><a href="#resources" aria-hidden="true" class="header-anchor">#</a> Resources</h2> <p>Using Docker and containerization is about breaking apart a monolith into microservices. Throughout this series, we will learn to master Docker and all its commands. Sooner or later you will want to take your containers to a production environment. That environment is usually the Cloud. When you feel you've got enough Docker experience have a look at these links to see how Docker can be used in the Cloud as well:</p> <ul><li><a href="https://docs.microsoft.com/en-gb/azure/containers/?wt.mc_id=academic-0000-chnoring" target="_blank" rel="noopener noreferrer">Containers in the Cloud<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
Great overview page that shows what else there is to know about containers in the Cloud</li> <li><a href="https://docs.microsoft.com/en-gb/azure/container-instances/container-instances-tutorial-prepare-app?wt.mc_id=academic-0000-chnoring" target="_blank" rel="noopener noreferrer">Deploying your containers in the Cloud<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> Tutorial that shows how easy it is to leverage your existing Docker skill and get your services running in the Cloud</li> <li><a href="https://docs.microsoft.com/en-gb/azure/container-instances/container-instances-tutorial-prepare-acr?wt.mc_id=academic-0000-chnoring" target="_blank" rel="noopener noreferrer">Creating a container registry<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
Your Docker images can be in Docker Hub but also in a Container Registry in the Cloud. Wouldn't it be great to store your images somewhere and actually be able to create a service from that Registry in a matter of minutes?</li></ul> <h2 id="environment-variables"><a href="#environment-variables" aria-hidden="true" class="header-anchor">#</a> Environment variables</h2> <p>One of the things I’ve shown you in previous articles is how we can specify environment variables. Now variables can be set in the <code>Dockerfile</code> but we can definitely set them on the command line and thereby also in Docker Compose and specifically in <code>docker-compose.yaml</code>:</p> <div class="language-docker line-numbers-mode"><pre class="language-docker"><code>// docker<span class="token punctuation">-</span>compose.yaml

version<span class="token punctuation">:</span> <span class="token string">'3'</span>
services<span class="token punctuation">:</span>
 product<span class="token punctuation">-</span>service<span class="token punctuation">:</span>
   build<span class="token punctuation">:</span>
     context<span class="token punctuation">:</span> ./product<span class="token punctuation">-</span>service
   ports<span class="token punctuation">:</span>
     <span class="token punctuation">-</span> <span class="token string">&quot;8000:3000&quot;</span>
   environment<span class="token punctuation">:</span>  
     <span class="token punctuation">-</span> test=testvalue 
 inventory<span class="token punctuation">-</span>service<span class="token punctuation">:</span>
   build<span class="token punctuation">:</span>
     context<span class="token punctuation">:</span> ./inventory<span class="token punctuation">-</span>service
   ports<span class="token punctuation">:</span>
   <span class="token punctuation">-</span> <span class="token string">&quot;8001:3000&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>Above we are creating an environment variable by defining environment followed by <code>-test=testvalue</code>, which means we create the variable test with value, <code>testvalue</code>.</p> <p>We can easily test that this works by reading from process.env.test in our app.js file for the product-service directory.</p> <p>Another way to test this is to run Docker compose and query for what environment variables are available, like so:</p> <p><img src="https://cdn-images-1.medium.com/max/1024/1*rOSUR7zhFT4SqO2-Hx4TBw.png" alt=""></p> <p>As you can see above we first run docker-compose ps and get the containers that are part of this Docker Compose session and then we run <code>docker exec [container name] env</code> to list the environment variables. A third option is to run <code>docker exec -it [container name] bash</code> and enter the container and use bash to echo out the variable value. There are quite a few ways to manage environment variables with Docker compose so have a read in the <a href="https://docs.docker.com/compose/environment-variables/" target="_blank" rel="noopener noreferrer">official docs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, what else you can do.</p> <h2 id="volumes"><a href="#volumes" aria-hidden="true" class="header-anchor">#</a> Volumes</h2> <p>We’ve covered volumes in an earlier part of this series and we found them to be a great way to:</p> <ul><li><strong>create a persistent space</strong> , this is ideal to create log files or output from a Database that we want to remain, once we tear down and run our containers</li> <li><strong>turn our development environment into a Volume</strong> , the benefits of doing so meant that we could start up a container and then change our code and see those changes reflected without having to rebuild or tear down our container, a real time saver.</li></ul> <h3 id="create-a-persistent-space"><a href="#create-a-persistent-space" aria-hidden="true" class="header-anchor">#</a> Create a persistent space</h3> <p>Let’s see how we can deal with Volumes in Docker compose:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// docker-compose.yml

version: '3'
services:
 product-service:
   build:
     context: ./product-service
   ports:
     - &quot;8000:3000&quot;
   environment:
     - test=testvalue
 inventory-service:
   build:
     context: ./inventory-service
   ports:
     - &quot;8001:3000&quot;
  volumes:  
    - my-volume:/var/lib/data

volumes:  
  my-volume:
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>Above we are creating a volume by the command volumes at the end of the file and on the second row we give it the name <code>my-volume</code>. Furthermore, in the inventory-service portion of our file, we refer to the just created volume and create a mapping to <code>/var/lib/data</code> which is a directory in the volume that will be persisted, through teardowns. Let’s look that it is correctly mapped:</p> <p><img src="https://cdn-images-1.medium.com/max/1024/1*4twcO-Lrvw-3B3l0bjHGoA.png" alt=""></p> <p>As can be seen, by the above command, we first enter the container with <code>docker exec</code> followed by us navigating to our mapping directory, it is there, great 😃.</p> <p>Let’s create a file in the data directory so we can prove that our volume mapping really works:</p> <blockquote><p>echo persist &gt; persist.log</p></blockquote> <p>The above command creates a file <code>persist.log</code> with the content persist . Nothing fancy but it does create a file that we can look for after tearing down and restarting our container.</p> <p>Now we can exit the container. Next, let’s recap on some useful Volume commands:</p> <blockquote><p>docker volume ls</p></blockquote> <p><img src="https://cdn-images-1.medium.com/max/1024/1*XDWyoIcwjNWcQjzCEM0FaQ.png" alt=""></p> <p>The above lists all the currently mounted volumes. We can see that our created Volume is there compose-experiments_my-volume .</p> <p>We can dive into more details with:</p> <blockquote><p>docker volume inspect compose-experiments_my-volume</p></blockquote> <p><img src="https://cdn-images-1.medium.com/max/1024/1*HXrFVqZwjwkkjTfEN3oNCQ.png" alt=""></p> <p>Ok, so it’s giving us some details about our volume such as <code>Mountpoint</code>, which is where files will be persisted when we write to our volume mapping directory in the container.</p> <p>Let’s now bring down our containers with:</p> <blockquote><p>docker-compose down</p></blockquote> <p>This means that the Volume should still be there so let’s bring them all up with:</p> <blockquote><p>docker-compose up -d</p></blockquote> <p>Let’s enter the container next and see if our persist.log file is there:</p> <p><img src="https://cdn-images-1.medium.com/max/1024/1*dSGfuvU53coEhcMPhbw9oQ.png" alt=""></p> <p>Oh yeah, it works.</p> <p>###Turn your current directory into a Volume</p> <p>Ok, for this we need to add a new volume and we need to point out a directory on our computer and a place in the container that should be in sync. Your <code>docker-compose.yaml</code> file should look like the following:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// docker-compose.yaml

version: '3'
services:
  product-service:
    build:
      context: ./product-service
    ports:
      - &quot;8000:3000&quot;
    environment:
      - test=testvalue
    volumes:  
      - type: bind  
      source: ./product-service  
      target: /app  
  inventory-service:
    build:
      context: ./inventory-service
    ports:
      - &quot;8001:3000&quot;
    volumes:
      - my-volume:/var/lib/data

volumes:
  my-volume:
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>The new addition is added to the <code>product-service</code>. We can see that we are specifying a volumes command with one entry. Let’s break down that entry:</p> <ul><li><strong>type: bind</strong> , this creates a so-called <a href="https://docs.docker.com/storage/bind-mounts/" target="_blank" rel="noopener noreferrer"><em>bind mount</em><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, a type of volume more fit for purpose of syncing files between your local directory and your container</li> <li><strong>source</strong> , this is simply where your files are, as you can see we are pointing out <code>./product-service</code>. This means that as soon as we change a file under that directory Docker will pick up on it.</li> <li><strong>target</strong> , this is the directory in the container, source and target will now be in sync we do a change in source, the same change will happen to target</li></ul> <p>##Networks and databases</p> <p>Ok then, this is the last part we aim to cover in this article. Let’s start with databases. All major vendors have a Docker image like Sql Server, Postgres, MySQL and so on. This means we don’t need to do the build-step to get them up and running but we do need to set things like environment variables and of course open up ports so we can interact with them. Let’s have a look at how we can add a MySQL database to our solution, that is our <code>docker-compose.yml</code> file.</p> <h3 id="adding-a-database"><a href="#adding-a-database" aria-hidden="true" class="header-anchor">#</a> Adding a database</h3> <p>Adding a database to <code>docker-compose.yaml</code> is about adding an already premade image. Lucky for us MySQL already provides a ready-made one. To add it we just need to add another entry under services: like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// docker-compose.yaml

product-db:
  image: mysql
  environment:
    - MYSQL_ROOT_PASSWORD=complexpassword
  ports:
    - 8002:3306
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Let’s break it down:</p> <ul><li><code>product-db</code> is the name of our new service entry, we choose this name</li> <li><code>image</code> is a new command that we are using instead of build , we use this when the image is already built, which is true for most databases</li> <li><code>environment</code> , most databases will need to have a certain number of variables set to be able to connect to them like username, password and potentially the name of the database, this varies per type of database. In this case, we set MYSQL_ROOT_PASSWORD so we instruct the MySQL instance what the password is for the root user. We should consider creating a number of users with varying access levels</li> <li>ports, this is exposing the ports that will be open and thereby this is our entrance in for talking to the database. By typing <code>8002:3306</code> we say that the container's port <code>3306</code> should be mapped to the external port <code>8002</code></li></ul> <p>Let’s see if we can get the database and the rest of our services up and running:</p> <blockquote><p>docker-compose up -d</p></blockquote> <p><img src="https://cdn-images-1.medium.com/max/1024/1*TRzocCrQzt2dzD7BowtXFw.png" alt=""></p> <p>Let’s verify with:</p> <blockquote><p>docker-compose ps OR docker ps</p></blockquote> <p><img src="https://cdn-images-1.medium.com/max/1024/1*mv-p4iFB2sUx3YD80FWa7w.png" alt=""></p> <p>Looks, good, our database service <code>experiments_product-db_1</code> seems to be up and running on port <code>8002</code>. Let’s see if we can connect to the database next. The below command will connect us to the database, fingers crossed 😉</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>mysql -uroot -pcomplexpassword -h 0.0.0.0 -P 8002
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://cdn-images-1.medium.com/max/498/1*2_db0xR6z_9mcYLLsi-u3w.gif" alt=""></p> <p>and the winner is…</p> <p><img src="https://cdn-images-1.medium.com/max/1024/1*ddxwWglQQqg2q1v4Cnt5UA.png" alt=""></p> <p>Great, we did it. Next up let’s see if we can update one of our services to connect to the database.</p> <h3 id="connecting-to-the-database"><a href="#connecting-to-the-database" aria-hidden="true" class="header-anchor">#</a> Connecting to the database</h3> <p>There are three major ways we could be connecting to the database:</p> <ul><li>using docker client, we’ve tried this one already with <code>mysql -uroot -pcomplexpassword -h 0.0.0.0 -P 8002</code></li> <li>enter our container, we do this using <code>docker exec -it [name of container] bash</code> and then we type <code>mysql</code> inside of the container</li> <li>connecting through our app, this is what we will look at next using the NPM library mysql</li></ul> <p>We will focus on the third choice, connecting to a database through our app. The database and the app will exist in different containers. So how do we get them to connect? The answer is:</p> <ul><li><strong>needs to be in the same network</strong> , for two containers to talk to each other they need to be in the same network</li> <li><strong>database needs to be ready</strong> , it takes a while to start up a database and for your app to be able to talk to the database you need to ensure the database have started up correctly, this was a <em>fun/interesting/painful</em> til I figured it out, so don’t worry I got you, we will succeed 😃</li> <li><strong>create a connection object</strong> , ensure we set up the connection object correctly in <code>app.js</code> for <code>product-service</code></li></ul> <p>Let’s start with the first item here. How do we get the database and the container into the same network? Easy, we create a network and we place each container in that network. Let’s show this in <code>docker-compose.yaml</code>:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// excerpt from docker-compose.yaml

networks:
  products:
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>We need to assign this network to each service, like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// excerpt from docker-compose.yaml

services:
  some-service:
    networks:  
      - products
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>Now, for the second bullet point, how do we know that the database is finished initializing? Well, we do have a property called <code>depends_on</code>, with that property, we are able to specify that one container should wait for another container to start up first. That means we can specify it like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// excerpt from docker-compose.yaml

services:
 some-service:
   depends_on: db
 db:
   image: mysql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Great so that solves it or? Nope nope nope, hold your horses:</p> <p><img src="https://cdn-images-1.medium.com/max/575/1*Ons95kxrJQd3lbF9XzKscg.gif" alt=""></p> <p>So in Docker compose version 2 there used to be an alternative where we could check for a service’s health, if health was good we could process to spin up our container. It looked like so:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>depends_on:
 db:
   condition: service_healthy
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>This meant that we could wait for a database to initialize fully. This was not to last though, in version 3 this option is gone. Here is doc page that explains why, <a href="https://docs.docker.com/compose/startup-order/" target="_blank" rel="noopener noreferrer">control startup and shutdown order<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. The gist of it is that now it’s up to us to find out when our database is done and ready to connect to. Docker suggests several scripts for this:</p> <ul><li><a href="https://github.com/vishnubob/wait-for-it" target="_blank" rel="noopener noreferrer">wait-for-it<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/jwilder/dockerize" target="_blank" rel="noopener noreferrer">dockerize<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/Eficode/wait-for" target="_blank" rel="noopener noreferrer">wait-for<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>All these scripts have one thing in common, the idea is to listen to a specific <code>host</code> and <code>port</code> and when that replies back, then we run our app. So what do we need to do to make that work? Well let’s pick one of these scripts, namely <code>wait-for-it</code> and let’s list what we need to do:</p> <ul><li><strong>copy</strong> this script into your service container</li> <li><strong>give</strong> the script execution rights</li> <li><strong>instruct</strong> the docker file to run the script with database host and port as args and then to run the service once the script OKs it</li></ul> <p>Let’s start with copying the script from GitHub into our <code>product-service</code> directory so it now looks like this:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>/product-service
  wait-for-it.sh
  Dockerfile
  app.js
  package.json
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Now let’s open up the <code>Dockerfile</code> and add the following:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// Dockerfile

FROM node:latest

WORKDIR /app

ENV PORT=3000

COPY . .

RUN npm install

EXPOSE $PORT

COPY wait-for-it.sh /wait-for-it.sh

RUN chmod +x /wait-for-it.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>Above we are copying the <code>wait-for-it.sh</code> file to our container and on the line below we are giving it execution rights. Worth noting is how we also remove the <code>ENTRYPOINT</code> from our <code>Dockerfile</code>, we will instead instruct the container to start from the <code>docker-compose.yaml</code> file. Let’s have a look at said file next:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// excerpt from docker-compose.yaml

services:
 product-service:
 command: [&quot;/wait-for-it.sh&quot;, &quot;db:8002&quot;, &quot;--&quot;, &quot;npm&quot;, &quot;start&quot;]
 db:
 // definition of db service below
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Above we are telling it to run the <code>wait-for-it.sh</code> file and as an argument use <code>db:8002</code> and after it gets a satisfactory response then we can go on to run <code>npm start</code> which will then start up our service. That sounds nice, will it work?</p> <p>For full disclosure let’s show our full <code>docker-compose.yaml</code> file:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>version: '3.3'
  services:
    product-service:
      depends_on:
        - &quot;db&quot;
      build:
        context: ./product-service
      command: [&quot;/wait-for-it.sh&quot;, &quot;db:8002&quot;, &quot;--&quot;, &quot;npm&quot;, &quot;start&quot;]
    ports:
      - &quot;8000:3000&quot;
    environment:
      - test=testvalue
      - DATABASE_PASSWORD=complexpassword
      - DATABASE_HOST=db
    volumes:
      - type: bind
      source: ./product-service
      target: /app
    networks:
      - products
   db:
     build: ./product-db
       restart: always
     environment:
       - &quot;MYSQL_ROOT_PASSWORD=complexpassword&quot;
       - &quot;MYSQL_DATABASE=Products&quot;
     ports:
       - &quot;8002:3306&quot;
     networks:
       - products
   inventory-service:
     build:
       context: ./inventory-service
     ports:
       - &quot;8001:3000&quot;
     volumes:
       - my-volume:/var/lib/data

volumes:
 my-volume:

networks:
 products:
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>Ok, so to recap we placed <code>product-service</code> and <code>db</code> in the network <code>products</code> and we downloaded the script <code>wait-for-it.sh</code> and we told it to run before we spun up the app and in the process listen for the host and port of the database that would respond as soon as the database was ready for action. That means we have one step left to do, we need to adjust the <code>app.js</code> file of the <code>product-service</code>, so let’s open that file up:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// app.js</span>

<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mysql'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span> <span class="token operator">||</span> <span class="token number">3000</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> test <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>test<span class="token punctuation">;</span>

<span class="token keyword">let</span> attempts <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> seconds <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  attempts<span class="token operator">++</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">,</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DATABASE_PASSWORD</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'host'</span><span class="token punctuation">,</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DATABASE_HOST</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`attempting to connect to DB time: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>attempts<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token keyword">const</span> con <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  
   host<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DATABASE_HOST</span><span class="token punctuation">,</span>  
   user<span class="token punctuation">:</span> <span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span>  
   password<span class="token punctuation">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DATABASE_PASSWORD</span><span class="token punctuation">,</span>  
   database<span class="token punctuation">:</span> <span class="token string">'Products'</span>  
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  con<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
   <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Error&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>  
     <span class="token function">setTimeout</span><span class="token punctuation">(</span>connect<span class="token punctuation">,</span> <span class="token number">30</span> <span class="token operator">*</span> seconds<span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'CONNECTED!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>

  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  conn<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'shit happened :)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
    <span class="token punctuation">}</span>   
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Hello product service, changed </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>test<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Example app listening on port </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">!`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><p>Above we can see that we have defined a <code>connect()</code> method that creates a connection by invoking <code>createConnection()</code> with an object as an argument. That input argument needs to know <code>host</code>, <code>user</code>, <code>password</code> and <code>database</code>. That seems perfectly reasonable. We also add a bit of logic to the <code>connect()</code> method call namely we invoke <code>setTimeout()</code>, this means that it will attempt to do another connection after 30 seconds. Now, because we use <code>wait-for-it.sh</code> that functionality isn’t really needed but we could rely on application code alone to ensure we get a connection. However, we also call <code>conn.on('error')</code> and the reason for doing so is that we can loose a connection and we should be good citizens and ensure we can get that connection back.</p> <p>Anyway, we’ve done everything in our power, but because we’ve introduced changes to <code>Dockerfile</code> let’s rebuild everything with <code>docker-compose build</code> and then let’s bring everything up with:</p> <blockquote><p>docker-compose up</p></blockquote> <p>and….</p> <p><img src="https://cdn-images-1.medium.com/max/1024/1*-2XpY_avDd46TWcMa8EJHg.png" alt=""></p> <p>There it is, Houston WE HAVE A CONNECTION, or as my friend Barney likes to put it:</p> <p><img src="https://cdn-images-1.medium.com/max/496/1*a3L6-JOjwaH5f5cMjbCmtg.gif" alt=""></p> <h3 id="setting-up-the-database-—-fill-it-with-structure-and-data"><a href="#setting-up-the-database-—-fill-it-with-structure-and-data" aria-hidden="true" class="header-anchor">#</a> Setting up the database — fill it with structure and data</h3> <p>Ok, maybe you were wondering about the way we built the service db ? That part of <code>docker-compose.yaml</code> looked like this:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// docker-compose.yaml

db:
  build: ./product-db
  restart: always
  environment:
    - &quot;MYSQL_ROOT_PASSWORD=complexpassword&quot;
    - &quot;MYSQL_DATABASE=Products&quot;
  ports:
    - &quot;8002:3306&quot;
  networks:
    - products
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>I would you to look at build especially. We mentioned at the beginning of this article that we can pull down ready-made images of databases. That statement is still true but by creating our own Dockerfile for this, we can not only specify the database we want but we can also run commands like creating our database structure and insert seed data. Let’s have a close look at the directory <code>product-db</code>:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>/product-db
  Dockerfile
  init.sql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Ok, we have a <code>Dockerfile</code>, let’s look at that first:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// Dockerfile

FROM mysql:5.6

ADD init.sql /docker-entrypoint-initdb.d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>We specify that <code>init.sql</code> should be copied and renamed to <code>docker-entrypoint-initdb.d</code> which means it will run the first thing that happens. Great, what about the content of <code>init.sql</code>?</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>// init.sql

CREATE DATABASE IF NOT EXISTS Products;

# create tables here
# add seed data inserts here
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>As you can see it doesn’t contain much for the moment but we can definitely expand it, which is important.</p> <h2 id="summary"><a href="#summary" aria-hidden="true" class="header-anchor">#</a> Summary</h2> <p>We have now come full circle in this series, we have explained everything from the beginning. The basic concepts, the core commands, how to deal with volumes and databases and also how to be even more effective with Docker Compose. This series will continue of course and go deeper and deeper into Docker but this should hopefully take you a bit on the way. Thanks for reading this far.</p> <hr></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.95c997f3.js" defer></script><script src="/assets/js/9.454b5262.js" defer></script><script src="/assets/js/4.eac68367.js" defer></script><script src="/assets/js/136.5f5c962b.js" defer></script>
  </body>
</html>
